#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\begin_preamble

 
\end_preamble
\use_default_options true
\maintain_unincluded_children false
\language american
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize 11
\spacing double
\use_hyperref false
\papersize letterpaper
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine biblatex-natbib
\cite_engine_type authoryear
\biblio_style plainnat
\biblio_options maxnames=5
\biblatex_bibstyle numeric
\biblatex_citestyle numeric
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 3cm
\topmargin 2cm
\rightmargin 3cm
\bottommargin 2cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation skip
\defskip smallskip
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes true
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\author 880794617 "Frank Noe"
\end_header

\begin_body

\begin_layout Title
Title: Boltzmann Generators
\end_layout

\begin_layout Standard

\series bold
Authors
\series default
: Frank Noé
\begin_inset Formula $^{1,2*}$
\end_inset

 and Hao Wu
\begin_inset Formula $^{1,3}$
\end_inset


\end_layout

\begin_layout Standard

\series bold
One Sentence Summary
\series default
: Combining deep learning and statistical mechanics, we develop neural networks
 that sample the Boltzmann distribution of complex many-body systems.
\end_layout

\begin_layout Standard

\series bold
Affiliations
\series default
: 
\end_layout

\begin_layout Standard
\begin_inset Formula $1$
\end_inset

: FU Berlin, Department of Mathematics and Computer Science, Arnimallee
 6, 14195 Berlin
\change_inserted 880794617 1542209491

\end_layout

\begin_layout Standard

\change_inserted 880794617 1542209581
\begin_inset Formula $2$
\end_inset

: Rice University, Department of Chemistry, Houston, Texas 77005, United
 States
\end_layout

\begin_layout Standard

\change_inserted 880794617 1542209783
\begin_inset Formula $3$
\end_inset

: Tongji University, School of Mathematical Sciences, Shanghai, 200092,
 P.R.
 China
\change_unchanged

\end_layout

\begin_layout Standard
*: Correspondance to: frank.noe@fu-berlin.de
\end_layout

\begin_layout Standard

\series bold
Abstract
\series default
: Computing equilibrium structures and statistics of condensed-matter many-body
 systems such as spin systems or solvated macromolecules presently relies
 on computationally intensive simulations such as molecular dynamics (MD)
 or Markov-chain Monte Carlo (MCMC) that take many small steps in configuration
 space.
 Here we combine recent progress in deep learning with principles of statistical
 mechanics to develop Boltzmann Generators – neural networks that learn
 a variable transformation such that the equilibrium distribution of a given
 many-body system can be 
\begin_inset Quotes eld
\end_inset

one-shot
\begin_inset Quotes erd
\end_inset

 sampled, i.e.
 by sampling statistically independent random variables from a simple distributi
on in the transformed space.
 As an input, the Boltzmann Generator only needs to know the potential energy
 function of the system, and optionally examples of known configurations.
 Boltzmann Generators can both compute statistics, e.g., free energy differences,
 of known system states or phases, and discover new ones many orders of
 magnitude faster than a local MD or MCMC method.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout

\series bold
Next TODOs
\series default
:
\end_layout

\begin_layout Itemize

\series bold
Clean up temperature prefactor mess
\series default
: analysis.free_energy_bootstrap(), EnergyInvNet.sample(), ...
 Where do we need to include the temperature factor, and where not? How
 should weights be interpreted?
\end_layout

\begin_layout Itemize

\series bold
Multi-temperature
\series default
: Training with more temperatures, train with gradual removing of ML part.
 Test if we can reach a situation where zero ML contribution is stable and
 doesn't lead to an exploding z space.
\end_layout

\begin_layout Itemize
Understand bimodality in J values for unsupervised training (Idea: the network
 takes most of the z-density and scales it to a small x region)
\end_layout

\begin_deeper
\begin_layout Itemize
Fix 1: Re-introduce J-restraint in last training stage
\end_layout

\begin_layout Itemize
Fix 2: Combine supervised + unsupervised
\end_layout

\end_deeper
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Section*
Done
\end_layout

\begin_layout Itemize

\series bold
(done) Multi-Temperature
\series default
:
\end_layout

\begin_deeper
\begin_layout Itemize

\series bold
rc_entropy
\series default
 does currently not depend on temperature, therefore we try to make the
 sum distribution uniform, which is not correct.
\end_layout

\begin_layout Itemize

\series bold
W2-loss
\series default
 different temperatures may have different scaling factors.
 Therefore making the weights of all temperatures equal without considering
 the weighting factors probably does not have the correct effect.
\end_layout

\end_deeper
\begin_layout Itemize

\series bold
(failure) Center distributions
\series default
: Each trajectory should be centered (mean 0) or subject to ML.
 How can we do that rather than splitting the space between trajectories?
 
\end_layout

\begin_layout Itemize

\series bold
(failed) Heavy tail distribution
\series default
: Seems to just reparametrize the same problem.
\end_layout

\begin_layout Itemize
Optimizing acceptance rate 
\series bold
supervised problem
\series default
: One of the two states dominates, even when we train with metric
\end_layout

\begin_deeper
\begin_layout Itemize
(
\series bold
failed
\series default
) Fix 1: symmetric: does not fix it.
\end_layout

\end_deeper
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Section*
Minimal Paper Checklist
\end_layout

\begin_layout Itemize

\series bold
Form
\series default
: 3-page style Science or Nat.
 Phys.
 + SI.
\end_layout

\begin_layout Itemize
(
\series bold
Done
\series default
) Latent sampling idea.
 Sell as 
\begin_inset Quotes eld
\end_inset

variable/coordinate transformation
\begin_inset Quotes erd
\end_inset

 to physicists.
\end_layout

\begin_layout Itemize
Demonstrate that realistic structures / low energies can be sampled directly
 for 3 systems: 
\end_layout

\begin_deeper
\begin_layout Itemize
(
\series bold
Done
\series default
) double well
\end_layout

\begin_layout Itemize
(
\series bold
Done
\series default
) particle system
\end_layout

\begin_layout Itemize
hydrocarbons.
\end_layout

\end_deeper
\begin_layout Itemize
Demonstrate that free energy differences can be computed efficiently for
 3 systems
\end_layout

\begin_deeper
\begin_layout Itemize
(
\series bold
Done
\series default
) double well
\end_layout

\begin_layout Itemize
(
\series bold
Done
\series default
) particle system
\end_layout

\begin_layout Itemize
protein.
\end_layout

\end_deeper
\begin_layout Itemize
Hydrocarbons:
\end_layout

\begin_deeper
\begin_layout Itemize
Generate Structures for cyclical (9-) hydrocarbon and polycyclical (?)
\end_layout

\end_deeper
\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="9" columns="14">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $n_{l}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{ML}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{KL}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $ex$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $n_{l}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{ML}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{KL}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $ex$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
267
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
283
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
50
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
456
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
49
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
437
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
157
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
138
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
50
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
362
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
51
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
448
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
34
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
514
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
47
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
567
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
267
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
54
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
547
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Itemize
Outline ideas to extend this method to Latent MCMC, FEP, Adaptive sampling
 etc.
 (+demonstrate for double well? Danger: request to do this for the other
 systems as well, but it doesn't work well for those yet)
\end_layout

\begin_layout Itemize
Symbols: We have used 
\begin_inset Formula $S$
\end_inset

 and 
\begin_inset Formula $T$
\end_inset

 for the nonlinear transformations in the NN.
 Then it is confusing to also use 
\begin_inset Formula $T$
\end_inset

 (
\begin_inset Formula $T_{xy}/T_{yx}$
\end_inset

) for the whole network.
 Maybe 
\begin_inset Formula $F$
\end_inset

?
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Section*
Overview / TODOs
\end_layout

\begin_layout Enumerate

\series bold
Data
\series default
: Long Hungarian Trajectory is so far the best.
 Couldn't get similar performance with restrained trajectory.
\end_layout

\begin_layout Enumerate

\series bold
Training
\series default
: 
\end_layout

\begin_deeper
\begin_layout Enumerate
Implement training of Gaussian in 
\begin_inset Formula $z$
\end_inset

 and likelihood in 
\begin_inset Formula $x$
\end_inset

 simultaneously (I have started this, but there was a bug)
\end_layout

\begin_layout Enumerate
(
\series bold
done
\series default
) Hyperparameters for z training: now we mainly do KL training, so this
 is not so important.
 Just avoid overfitting at this stage by doing early stopping.
\end_layout

\begin_layout Enumerate
Hyperparameters for E training: The resulting network can perform quite
 efficiently with Prior MCMC when being sampled using the same 
\begin_inset Formula $\mathbf{z}$
\end_inset

 standard deviation used in training.
 Some sampling data for the particle dimer system with distance 
\begin_inset Formula $d$
\end_inset

, where training has been done with samples from 
\begin_inset Formula $\sigma_{\mathbf{z}}$
\end_inset

: 
\begin_inset Tabular
<lyxtabular version="3" rows="12" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\sigma_{\mathbf{z}}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $N_{\mathrm{transition}}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{acf}_{\tau=100}(d)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{acf}_{\tau=10,000}(d)$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.01
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.99
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.89
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.02 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.99
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.89
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.05 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.99
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.74
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.99
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.58
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.2 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
16
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.98
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.40
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.5 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
38 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.98
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.68
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.9
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
7100
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.68
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.21
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10159
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.65
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.09
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5945
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.69
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.13
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
516
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.92
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.36
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
14
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.99
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.78
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Enumerate

\series bold
Hyperparameter search for E training
\series default
.
 
\end_layout

\begin_deeper
\begin_layout Enumerate
New code, tested only on min Energy and networks with two R and variably
 many N layers:
\end_layout

\begin_deeper
\begin_layout Enumerate
Deeper networks were better.
\end_layout

\begin_layout Enumerate
200 hidden units better than 100
\end_layout

\begin_layout Enumerate
lower z std (0.6) worked well, but higher z std also worked OK.
\end_layout

\end_deeper
\end_deeper
\begin_layout Enumerate

\series bold
(Done) Most meaningful loss so far seems to be
\series default
:
\begin_inset Formula 
\[
KL(p(x)\parallel\mu(x))+Shape(z)+Var_{1}(z_{scaled})
\]

\end_inset

Current best results: KL-loss 250.
 Std 
\begin_inset Formula $z$
\end_inset

: 1 (train) 1.3 (test).
 
\begin_inset Formula $N_{trans}\approx200$
\end_inset

.
 
\end_layout

\begin_layout Enumerate

\series bold
Reduce target variance
\series default
 for training data in order to account for increase of variance in test
 data.
\end_layout

\begin_layout Enumerate

\series bold
Reinforcement learning
\series default
: iterate (–> currently does not improve validation std_z.
 Revise protocol.):
\end_layout

\begin_deeper
\begin_layout Enumerate
Train with 
\begin_inset Formula $(\mathbf{x},\mathbf{w})$
\end_inset

 (initialized training data 
\begin_inset Formula $\mathbf{x}$
\end_inset

 from simulations in both endstates).
\end_layout

\begin_layout Enumerate
Generate new data 
\begin_inset Formula $\mathbf{x}^{*}$
\end_inset

 by sampling 
\begin_inset Formula $\mathbf{z}\sim\mathcal{N}(0,I)$
\end_inset

 (already happening in step ii, perhaps we can reuse it).
\end_layout

\begin_layout Enumerate
Run a few Metropolis steps to propagate 
\begin_inset Formula $\mathbf{x}^{*}\rightarrow\mathbf{x}^{**}$
\end_inset

.
\end_layout

\begin_layout Enumerate
Replace or augment 
\begin_inset Formula $\mathbf{x}$
\end_inset

 by 
\begin_inset Formula $\mathbf{x}^{**}$
\end_inset

.
\end_layout

\end_deeper
\end_deeper
\begin_layout Enumerate

\series bold
Applications
\series default
:
\end_layout

\begin_deeper
\begin_layout Enumerate
Identical partical exchange in particle dimer: 
\series bold
Transferability issue
\series default
 – training NICER network on one simulation and application to another leads
 to loss of overlap.
\end_layout

\begin_deeper
\begin_layout Enumerate

\series bold
(done) Hungarian method
\series default
: Using longer simulations and Hungarian method helps a lot.
 Using NICER network on an independent dataset is still not great but starts
 looking OK and monomodal in z.
 
\begin_inset Newline newline
\end_inset


\begin_inset Formula $\rightarrow$
\end_inset

 Works OK for short trajectories but not as well.
 Using longer trajectories now and storing data for quick recovery.
\end_layout

\begin_layout Enumerate

\series bold
(done) Data augmentation
\series default
: Check if we can get away by mixing all indices in the training data.
\begin_inset Newline newline
\end_inset


\begin_inset Formula $\rightarrow$
\end_inset

 Not trainable to good validation error.
 
\end_layout

\begin_layout Enumerate

\series bold
Test
\series default
: Check if initial shuffling (DA) of indices does not affect energies and
 training when used with Hungarian method, as expected.
 
\end_layout

\end_deeper
\begin_layout Enumerate
CG Fip35 System
\end_layout

\begin_deeper
\begin_layout Enumerate
Analyze Justin's data – do we have everything to implement an energy and
 simulate it?
\end_layout

\begin_layout Enumerate
Try simulating it with MCMC.
 Can we observe folding/unfolding?
\end_layout

\begin_layout Enumerate
Apply NICER to this system
\end_layout

\end_deeper
\end_deeper
\begin_layout Enumerate

\series bold
Analysis
\series default
:
\end_layout

\begin_deeper
\begin_layout Enumerate

\series bold
Transition rates for particle system
\series default
: Approximate transition rates for particle system by changing the barrier
 height without changing the minima –> 
\series bold
computing
\series default
.
\end_layout

\begin_layout Enumerate

\series bold
Run particle system training for different slope values
\series default
.
\end_layout

\begin_deeper
\begin_layout Enumerate
Write and run scripts.
\end_layout

\begin_layout Enumerate
Analyze and compare with available US results.
\end_layout

\end_deeper
\begin_layout Enumerate

\series bold
Efficiency
\series default
: Find a way to compare efficiency of samplers.
 Number of independent samples?
\end_layout

\end_deeper
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Section

\series bold
Introduction
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\series bold
Main Text
\series default
:
\end_layout

\begin_layout Standard
Statistical mechanics is concerned with computing the average behavior of
 many copies of a physical system based on models of its microscopic constituent
s and their interactions.
 For example, what is the average magnetization in an Ising model of interacting
 magnetic spins in an external field, or what is the probability of a protein
 to be folded in an atomistic molecular model as a function of the temperature.
 Under a wide range of conditions, the equilibrium probability of a microscopic
 configuration 
\begin_inset Formula $\mathbf{x}$
\end_inset

 (setting of all spins, positions of all protein atoms, etc.) is proportional
 to 
\begin_inset Formula $\mathrm{e}^{-u(\mathbf{x})}$
\end_inset

, 
\change_inserted 880794617 1542299913
for example
\change_unchanged
, the 
\change_inserted 880794617 1542299920
famous 
\change_unchanged
Boltzmann distribution.
 The dimensionless energy 
\begin_inset Formula $u(\mathbf{x})$
\end_inset

 contains the potential energy of the system, the temperature and optionally
 other thermodynamic quantities (SI).
 
\end_layout

\begin_layout Standard
Except for simple model systems, we presently have no approach to directly
 draw statistically independent samples 
\begin_inset Formula $\mathbf{x}$
\end_inset

 from 
\change_deleted 880794617 1542299927
the 
\change_unchanged
Boltzmann
\change_inserted 880794617 1542299929
-type
\change_unchanged
 distribution
\change_inserted 880794617 1542299931
s
\change_unchanged
 in order to compute 
\change_inserted 880794617 1542299963
statistics of the system,
\change_unchanged
 such as free energy differences.
 Therefore, currently used simulation methods are variants of Markov-Chain
 Monte Carlo (MCMC) or Molecular Dynamics (MD) simulations that make tiny
 changes to 
\begin_inset Formula $\mathbf{x}$
\end_inset

 in each simulation step and will, over a long time, generate trajectories
 that sample from the Boltzmann distribution.
 These methods suffer from rare events, i.e., many simulation steps are needed
 to transition between different phases or metastable (long-lived) states
 – for example, 
\begin_inset Formula $10^{9}-10^{15}$
\end_inset

 MD simulation steps are needed to fold or unfold a protein.
 As a result, these methods are extremely expensive and consume much of
 the worldwide supercomputing resources.
 
\change_inserted 880794617 1542299998
In specific cases, where low-dimensional coordinates can be identified that
 trace the r
\change_unchanged
are event transitions
\change_inserted 880794617 1542300006
, these 
\change_unchanged
can be sped up 
\change_inserted 880794617 1542300024
using
\change_unchanged
 enhanced sampling methods 
\begin_inset CommandInset citation
LatexCommand cite
key "Torrie_JCompPhys23_187,Grubmueller_PhysRevE52_2893,LaioParrinello_PNAS99_12562"
literal "false"

\end_inset

, but the computational effort remains enormous.
\end_layout

\begin_layout Standard
Here we set out to develop a 
\begin_inset Quotes eld
\end_inset

Boltzmann Generator
\begin_inset Quotes erd
\end_inset

 machine that is trained on a given energy function 
\begin_inset Formula $u(\mathbf{x})$
\end_inset

 and then produces statistically independent samples from 
\begin_inset Formula $\mathrm{e}^{-u(\mathbf{x})}$
\end_inset


\change_inserted 880794617 1542300036
, circumventing the sampling problem
\change_unchanged
.
 At first sight, this enterprise seems hopeless for condensed-matter systems
 and complex polymers (e.g., Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:particle_dimer"
plural "false"
caps "false"
noprefix "false"

\end_inset

a, Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:hydrocarbon"
plural "false"
caps "false"
noprefix "false"

\end_inset

k).
 In these systems, particles with strong repulsive interactions are densely
 packed in space, such that the number of low-energy configurations are
 vanishingly few compared to the number of possible ways to place particles.
 
\end_layout

\begin_layout Standard
Key to the solution is combining the strengths of deep machine learning
 
\begin_inset CommandInset citation
LatexCommand cite
key "LeCunBengioHinton_DeepLearning_Nature05"
literal "false"

\end_inset

 and statistical mechanics (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:illustration"
plural "false"
caps "false"
noprefix "false"

\end_inset

a): We train a deep invertible neural network, to learn a coordinate transformat
ion from 
\begin_inset Formula $\mathbf{x}$
\end_inset

 to a so-called 
\begin_inset Quotes eld
\end_inset

latent
\begin_inset Quotes erd
\end_inset

 representation 
\begin_inset Formula $\mathbf{z}$
\end_inset

, in which sampling is easy and every sample can be back-transformed to
 a configuration 
\begin_inset Formula $\mathbf{x}$
\end_inset

 with high Boltzmann probability.
 We can improve the ability to find relevant parts of configuration space
 by 
\begin_inset Quotes eld
\end_inset

learning from example
\begin_inset Quotes erd
\end_inset

, where we feed the Boltzmann Generator not only with the potential energy
 
\begin_inset Formula $u(\mathbf{x})$
\end_inset

, but also relevant samples 
\begin_inset Formula $\mathbf{x}$
\end_inset

, 
\change_inserted 880794617 1542300064
e.g.,
\change_unchanged
 from the folded or unfolded state of a protein, but without knowing the
 probabilities of these states.
 Then we employ statistical mechanics which offers a rich set of tools to
 generate the target distribution 
\begin_inset Formula $\mathrm{e}^{-u(\mathbf{x})}$
\end_inset

 when the proposal distribution is sufficiently similar.
\end_layout

\begin_layout Standard

\change_inserted 880794617 1542300094
This paper
\change_unchanged
 demonstrate
\change_inserted 880794617 1542300100
s
\change_unchanged
 that Boltzmann Generators can be trained to sample low-energy structures
 of condensed-matter systems and complex polymer structures in 
\begin_inset Quotes eld
\end_inset

one-shot
\begin_inset Quotes erd
\end_inset

.
 When the Boltzmann Generator is initialized with a few structures from
 different metastable states, it can generate independent samples from these
 states and can compute the free energy difference between them without
 suffering from rare events.
 We also demonstrate that the Boltzmann Generator has a chance of generating
 new, previously unseen states.
 Exploiting this property, an 
\begin_inset Quotes eld
\end_inset

iterative discovery
\begin_inset Quotes erd
\end_inset

 procedure is constructed in which the Boltzmann Generator gradually explores
 the state space.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout

\series bold
TODO
\series default
: say something about Neural renormalization group and Neural Hamiltonian
 Monte Carlo.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Section

\series bold
Boltzmann Generators
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Computational effort is to train the network, but then you generate the
 Boltzmann distribution in one shot, and you need only partial information
 to generate the network.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Neural networks that can draw statistically independent samples from a desired
 distribution are called directed generative networks 
\begin_inset CommandInset citation
LatexCommand cite
key "GoodfellowEtAl_GANs,KingmaWelling_ICLR14_VAE"
literal "false"

\end_inset

.
 Such generative networks have been demonstrated to draw photorealistic
 images 
\begin_inset CommandInset citation
LatexCommand cite
key "KarrasEtAl_ProgressiveGrowingGANs"
literal "false"

\end_inset

, to produce deceivingly realistic speech audio 
\begin_inset CommandInset citation
LatexCommand cite
key "VanDenOord_WaveNet2"
literal "false"

\end_inset

, and even to sample formulae of chemical compounds with certain physico-chemica
l properties 
\begin_inset CommandInset citation
LatexCommand cite
key "GomezBombarelli_ACSCentral_AutomaticDesignVAE"
literal "false"

\end_inset

.
 In these domains, the exact target distribution is not known and the network
 is 
\begin_inset Quotes eld
\end_inset

trained by example
\begin_inset Quotes erd
\end_inset

 using large databases of images, audio or molecules.
 Here we are in the inverse situation, as we can compute the Boltzmann weight
 of each generated sample 
\begin_inset Formula $\mathbf{x}$
\end_inset

, but we do not have samples from the Boltzmann distribution 
\emph on
a priori
\emph default
.
 The idea of Boltzmann Generators is as follows: 
\end_layout

\begin_layout Enumerate
We learn a neural network transformation 
\begin_inset Formula $F_{zx}$
\end_inset

 such that when sampling from a simple distribution in 
\begin_inset Formula $\mathbf{z}$
\end_inset

, such as a Gaussian normal distribution, 
\begin_inset Formula $F_{zx}(\mathbf{z})$
\end_inset

 will provide a configuration 
\begin_inset Formula $\mathbf{x}$
\end_inset

 which has a high Boltzmann weight, i.e.
 is coming from a distribution 
\begin_inset Formula $p_{X}(\mathbf{x})$
\end_inset

 that is similar to the target Boltzmann distribution (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:illustration"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
\end_layout

\begin_layout Enumerate
To compute Boltzmann-weighted averages, we reweight the generated distribution
 
\begin_inset Formula $p_{X}(\mathbf{x})$
\end_inset

 to the Boltzmann distribution 
\begin_inset Formula $\mathrm{e}^{-u(\mathbf{x})}$
\end_inset

.
 This can be achieved with various algorithms; here the simplest one is
 used: assign the statistical weight 
\begin_inset Formula $w(\mathbf{x})=\mathrm{e}^{-u(\mathbf{x})}/p_{X}(\mathbf{x})$
\end_inset

 to every sample 
\begin_inset Formula $\mathbf{x}$
\end_inset

 and then compute desired 
\change_inserted 880794617 1542300179
statistics, such as free energy differences
\change_unchanged
 using this weight.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/Fig_Illustration.pdf
	width 80text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:illustration"

\end_inset


\series bold
Boltzmann Generators.

\series default
 
\series bold
a)
\series default
 A Boltzmann Generator is trained by minimizing the difference between its
 generated distribution and the desired Boltzmann distribution.
 It is used by transforming samples from a simple (e.g., Gaussian) distribution
 to generated configurations.
 To compute thermodynamics, such as configurational free energies, the samples
 must be reweighted to the Boltzmann distribution.
 
\series bold
b)
\series default
 The Boltzmann Generator is composed of invertible neural network blocks.
 Here, a volume-preserving block is shown as an example.
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
CC: Too much detail.
 Put b-e in the SI.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
For both, training and reweighting, it is important that we can compute
 the probability 
\begin_inset Formula $p_{X}(\mathbf{x})$
\end_inset

 of 
\change_inserted 880794617 1542300219
generating a
\change_unchanged
 
\change_inserted 880794617 1542300226
configuration
\change_unchanged
 
\begin_inset Formula $\mathbf{x}$
\end_inset

.
 This can be achieved when 
\begin_inset Formula $F_{zx}$
\end_inset

 is an invertible transformation, for which we can compute 
\begin_inset Formula $p_{X}(\mathbf{x})$
\end_inset

 from the known 
\begin_inset Formula $p_{Z}(\mathbf{z})$
\end_inset

 (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:illustration"
plural "false"
caps "false"
noprefix "false"

\end_inset

, SI).
 Invertible neural network transformations are similar to flows of a fluid
 that transform the probability density from configuration space to latent
 space
\change_inserted 880794617 1542300244
, or backwards
\change_unchanged
.
 Here we consider invertible neural network blocks that are volume-preserving
 (as in incompressible fluids) 
\begin_inset CommandInset citation
LatexCommand cite
key "DinhDruegerBengio_NICE2015"
literal "false"

\end_inset

, and non-volume preserving (as in compressible fluids) 
\begin_inset CommandInset citation
LatexCommand cite
key "DinhBengio_RealNVP"
literal "false"

\end_inset

 (Suppl.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_network-architecture"
plural "false"
caps "false"
noprefix "false"

\end_inset

b-e).
 Invertibility is achieved by special neural network architectures (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:illustration"
plural "false"
caps "false"
noprefix "false"

\end_inset

b, Suppl.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_network-architecture"
plural "false"
caps "false"
noprefix "false"

\end_inset

c,e; see SI for details).
 Invertible blocks 
\change_inserted 880794617 1542300257
can be
\change_unchanged
 stacked 
\change_inserted 880794617 1542300272
in various configurations 
\change_unchanged
to form a deep invertible neural network (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:illustration"
plural "false"
caps "false"
noprefix "false"

\end_inset

a, Suppl.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:illustration"
plural "false"
caps "false"
noprefix "false"

\end_inset

f).
 
\change_inserted 880794617 1542300318
At least one non-volume preserving layer must be included so that the network
 is able to represent distributions with aribitrary 
\begin_inset Quotes eld
\end_inset

widths
\begin_inset Quotes erd
\end_inset

, or entropies.
\change_unchanged

\end_layout

\begin_layout Standard
Boltzmann Generators are trained with a combination of two modes: 
\emph on
training by energy
\emph default
 and 
\emph on
training by example
\emph default
.
 Training by energy is the main principle behind Boltzmann Generators, and
 proceeds as follows: We generate random vectors 
\begin_inset Formula $\mathbf{z}$
\end_inset

 sampled from a Gaussian distribution, and then transform them through the
 neural network to proposal configurations, 
\begin_inset Formula $\mathbf{x}=F_{zx}(\mathbf{x})$
\end_inset

.
 In this way, the Boltzmann Generator will generate configurations from
 a proposal distribution 
\begin_inset Formula $p_{X}(\mathbf{x})$
\end_inset

, which, initially will be very different from the Boltzmann distribution,
 and include structures with very high energies.
 Next we compute the difference between the generated distribution 
\begin_inset Formula $p_{X}(\mathbf{x})$
\end_inset

 from 
\begin_inset Formula $\mathrm{e}^{-u(\mathbf{x})}$
\end_inset

, which is – up to a constant – equal to the distribution we want to generate.
 For Boltzmann Generators, a natural way to compute this difference is the
 relative Entropy, also known as Kullback-Leibler (KL) divergence.
 As derived in the SI, the KL divergence can be computed 
\change_inserted 880794617 1542300349
as the following expectation value over samples 
\begin_inset Formula $\mathbf{z}$
\end_inset

:
\change_unchanged

\begin_inset Formula 
\begin{equation}
J_{KL}=\mathbb{E}_{\mathbf{z}}\left[u(F_{zx}(\mathbf{z}))-\log R_{zx}(\mathbf{z})\right]\label{eq:main_loss_KL}
\end{equation}

\end_inset

Here, 
\begin_inset Formula $u_{X}(F_{zx}(\mathbf{z}))$
\end_inset

 is the energy of the generated configuration.
 
\begin_inset Formula $R_{zx}$
\end_inset

 measures how much the network scales the configuration space volume at
 
\begin_inset Formula $\mathbf{z}$
\end_inset


\change_inserted 880794617 1542300363
, and
\change_unchanged
 therefore equals one for volume-preserving network blocks
\change_inserted 880794617 1542300378
, while it
\change_unchanged
 can be easily computed for non-volume-preserving network blocks (SI).
 In order to train the Boltzmann Generator, we approximate 
\begin_inset Formula $J_{KL}$
\end_inset

 using a few thousand samples, and then change the neural network parameters
 
\change_inserted 880794617 1542300394
so as to decrease 
\begin_inset Formula $J_{KL}$
\end_inset

.

\change_unchanged
 
\change_inserted 880794617 1542300425
A few hundred or thousand
\change_unchanged
 such iterations are required to train the Boltzmann Generator for the examples
 in this paper
\change_inserted 880794617 1542300586
.
 The
\change_unchanged
 resulting few million computations of the potential energy in Eq.
 (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:main_loss_KL"
plural "false"
caps "false"
noprefix "false"

\end_inset

) are the main computational investment to train the Boltzmann Generator
\change_inserted 880794617 1542300696
 and take several minutes for each system studied here
\change_unchanged
.
\change_inserted 880794617 1542300393

\end_layout

\begin_layout Standard

\change_inserted 880794617 1542275480
\begin_inset Note Note
status open

\begin_layout Plain Layout

\change_inserted 880794617 1542275497
- Explain entropy interpretation (minus a factor)
\end_layout

\end_inset


\change_unchanged

\end_layout

\begin_layout Standard

\change_inserted 880794617 1542276229
As shown in the SI, minimizing the KL divergence (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:main_loss_KL"
plural "false"
caps "false"
noprefix "false"

\end_inset

) is equivalent to minimizing the free energy of the generated distribution:
 The first term 
\begin_inset Formula $\mathbb{E}\left[u(F_{zx}(\mathbf{z}))\right]$
\end_inset

 is the mean potential energy, i.e.
 the enthalpy of the system.
 The second term 
\begin_inset Formula $\mathbb{E}\left[\log R_{zx}(\mathbf{z})\right]$
\end_inset

 can be shown to be equal to the entropic contribution to the free energy
 at the chosen temperature, plus a constant factor.
 The terms in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:main_loss_KL"
plural "false"
caps "false"
noprefix "false"

\end_inset

) counterplay in an interesting way: the first term tries to minimize the
 energy, and therefore trains the Boltzmann Generator to sample low-energy
 structures.
 The second term tries to maximize the entropy of the generated distribution,
 and therefore prevents the Boltzmann Generator from the so-called mode-collapse
, i.e.
 the repetitive sampling of a single minimum-energy configuration which
 would minimize the first term.
 
\end_layout

\begin_layout Standard

\change_inserted 880794617 1542275817
Despite the entropy term in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:main_loss_KL"
plural "false"
caps "false"
noprefix "false"

\end_inset

), training by energy alone is not sufficient as it tends to focus sampling
 on the most stable metastable state (Suppl.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_training_methods_NICER"
plural "false"
caps "false"
noprefix "false"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_training_methods_RealNVP"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
 We therefore additionally employ training by example, which is the standard
 training method used in other Machine Learning applications.
 In training by example, we initialize the Boltzmann Generator with some
 
\begin_inset Quotes eld
\end_inset

valid
\begin_inset Quotes erd
\end_inset

 configurations 
\begin_inset Formula $\mathbf{x}$
\end_inset

, e.g., from short initial MD simulations, and train it by feeding them through
 
\begin_inset Formula $F_{xz}$
\end_inset

 and maximizing their likelihood in the Gaussian distribution
\change_unchanged
 
\begin_inset CommandInset citation
LatexCommand cite
key "DinhDruegerBengio_NICE2015"
literal "false"

\end_inset

.
 
\change_inserted 880794617 1542275817
Training by example is especially used in the early stages of training,
 at it helps to train 
\begin_inset Formula $F_{zx}$
\end_inset

 to point to relevant parts of state space.
\change_unchanged

\end_layout

\begin_layout Standard
By combining training by energy and training by example, we can sample configura
tions that have high probabilities and low free energies.
 However, sometimes we want to generate certain states with a low probability,
 for example the transition states along a certain reaction coordinate (RC)
 along which we want to compute the free energy profile.
 Standard sampling methods, such as MD and MCMC, can be combined with Umbrella
 Sampling 
\begin_inset CommandInset citation
LatexCommand cite
key "Torrie_JCompPhys23_187"
literal "false"

\end_inset

, Metadynamics 
\begin_inset CommandInset citation
LatexCommand cite
key "LaioParrinello_PNAS99_12562"
literal "false"

\end_inset

 or Flooding 
\begin_inset CommandInset citation
LatexCommand cite
key "LaioParrinello_PNAS99_12562,Grubmueller_PhysRevE52_2893"
literal "false"

\end_inset

 in order to bias the sampled distribution to be more uniform along a chosen
 RC.
 For the same purpose, we introduce an RC loss that can optionally be used
 to enhance the sampling of a Boltzmann Generator along a chosen RC (SI).
\change_inserted 880794617 1542208119

\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Section

\series bold
Results
\end_layout

\end_inset


\end_layout

\begin_layout Standard
We first illustrate Boltzmann Generators using a two-dimensional potential
 that has two 
\change_inserted 880794617 1542300832
meta
\change_unchanged
stable states separated by a high energy barrier in 
\begin_inset Formula $x_{1}$
\end_inset

-direction, while it is a harmonic oscillator in 
\begin_inset Formula $x_{2}$
\end_inset

 (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

a).
 MD simulations will 
\change_inserted 880794617 1542300818
in
\change_unchanged
 one 
\change_inserted 880794617 1542300829
meta
\change_unchanged
stable state for a long time before a rare transition event occurs (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

b).
 Hence, the distribution in configuration space 
\begin_inset Formula $(x,y)$
\end_inset

 is split into two modes (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

c, transition state ensemble is shown in yellow for clarity but not used
 for training).
 We are training Boltzmann Generators using the two short and disconnected
 simulations shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

b as example.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

d,e show the latent space learned by non-volume-preserving and a volume-preservi
ng transformation, respectively.
 In both cases, the probability densities of the two states and the transition
 state are 
\begin_inset Quotes eld
\end_inset

repacked
\begin_inset Quotes erd
\end_inset

 so as to form a compact density 
\change_inserted 880794617 1542300840
around
\change_unchanged
 the 
\change_inserted 880794617 1542300848
origin
\change_unchanged
.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
The flow field shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

f shows how the volume-preserving transformation 
\begin_inset Formula $T_{zx}$
\end_inset

 
\begin_inset Quotes eld
\end_inset

unpacks
\begin_inset Quotes erd
\end_inset

 the latent density into the two-state configuration density (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

e
\begin_inset Formula $\rightarrow$
\end_inset

c).
 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
We use the Boltzmann generator by sampling from its latent space according
 to the Gaussian distribution.
 After transforming these variables via 
\begin_inset Formula $F_{zx}$
\end_inset

, this produces uncorrelated samples from both stable states without any
 sampling problem.
 A variety of training methods succeed in sampling across the barrier such
 that the rare event nature of the system is eliminated (Suppl.
 Figs.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_training_methods_NICER"
plural "false"
caps "false"
noprefix "false"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_training_methods_RealNVP"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
 Combining a Boltzmann Generator trained by 
\change_inserted 880794617 1542208152
energy and by example
\change_unchanged
 with simple reweighting reproduces the precise free energy differences
 of the two metastable states (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

g
\change_inserted 880794617 1542300862
,
\change_unchanged
 green).
 By additionally training with the RC loss to promote sampling along 
\begin_inset Formula $x_{1}$
\end_inset

, the low-probability transition states are sampled (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

f
\change_inserted 880794617 1542300859
,
\change_unchanged
 orange), and the full free energy profile along 
\begin_inset Formula $x_{1}$
\end_inset

 can be reconstructed with high precision (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

f,g
\change_inserted 880794617 1542300860
,
\change_unchanged
 orange).
\end_layout

\begin_layout Standard
For the double-well system, the unbiased MD simulation needs on average
 
\begin_inset Formula $4\cdot10^{6}$
\end_inset

 MD steps for a 
\change_inserted 880794617 1542208173
single 
\change_unchanged
return trip between the two states (SI)
\change_inserted 880794617 1542208497
, and about 
\begin_inset Formula $100$
\end_inset

 such crossings are required to compute the free energy difference with
 the same precision as the Boltzmann Generator results shown in (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

g)
\change_unchanged
.
 The 
\change_inserted 880794617 1542208541
total effort of training the Boltzmann Generator (including generating the
 initial simulation data) corresponds to about 
\begin_inset Formula $10^{6}$
\end_inset

 steps, but once this is done, statistically independent samples can be
 generated at no significant cost.
 For this simple system, the Boltzmann Generator is therefore about a factor
 
\begin_inset Formula $100$
\end_inset

 more efficient than direct simulation, but much more extreme savings can
 be observed for complex systems, as shown below.
\change_unchanged

\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout

\series bold
CC
\series default
: but you have used two short trajectories as input, so you need to consider
 the time to generate those.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout

\series bold
TODO
\series default
: Also show/describe Latent MCMC?
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/Fig_Results_DoubleWell.pdf
	lyxscale 80
	width 80text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:double_well"

\end_inset


\series bold
Illustration of Boltzmann Generators for two-dimensional bistable system.

\series default
 
\series bold
a)
\series default
 Two-dimensional potential, 
\begin_inset Formula $x_{1}$
\end_inset

 is the slow coordinate.
 
\series bold
b)
\series default
 Two short simulation trajectories that stay in their metastable states
 without crossing.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
c) Transformation flow of the neural network 
\begin_inset Formula $T_{zx}$
\end_inset

.
 
\end_layout

\end_inset


\series bold
c)
\series default
 Distribution of trajectories of b) in configuration space 
\begin_inset Formula $(x_{1},x_{2})$
\end_inset

.
 Transition state ensemble is shown (orange) but not used for training.
 
\series bold
d,e)
\series default
 Latent-space distribution of trajectories of b) when mapped through trained
 
\begin_inset Formula $F_{xz}$
\end_inset

 using 
\change_inserted 880794617 1542300912
transformations that are (d) 
\change_unchanged
non-volume preserving 
\change_inserted 880794617 1542300915
and 
\change_unchanged
(
\change_inserted 880794617 1542300916
e
\change_unchanged
) and volume-preserving 
\change_inserted 880794617 1542300937
with one global scaling factor.

\change_unchanged
 
\series bold
f)
\series default
 Free energy corresponding to distribution sampled by Boltzmann Generators
 trained 
\change_inserted 880794617 1542300976
by energy and by example
\change_unchanged
 (
\change_inserted 880794617 1542300980
KL+ML, 
\change_unchanged
green) and using reaction coordinate training (
\change_inserted 880794617 1542300985
KL+RC, 
\change_unchanged
orange).
 
\series bold
g)
\series default
 Free energy estimates obtained after reweighting, colors as in (f).
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
As a second example, we demonstrate that Boltzmann Generators can sample
 high-probability structures and efficiently compute the thermodynamics
 in crowded condensed matter systems.
 We simulated a dense system of two-dimensional particles confined to a
 box as suggested in 
\begin_inset CommandInset citation
LatexCommand cite
key "NilmeyerEtAl_PNA11_NCMC"
literal "false"

\end_inset

 (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:particle_dimer"
plural "false"
caps "false"
noprefix "false"

\end_inset

a).
 Immersed in the fluid is a bistable particle dimer whose open and closed
 states are separated by a high barrier (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:particle_dimer"
plural "false"
caps "false"
noprefix "false"

\end_inset

a-c).
 
\change_inserted 880794617 1542300997
O
\change_unchanged
pening or closing the dimer 
\change_inserted 880794617 1542301002
directly 
\change_unchanged
is not possible due to the high density of the system
\change_inserted 880794617 1542301006
, but rather
\change_unchanged
 requires a concerted rearrangement of the solvent particles.
 Particles repel each other with the 
\begin_inset Formula $12^{th}$
\end_inset

 power of their inverse distance when being close.
 As a result, the fraction of low-energy configurations is vanishingly small,
 and 
\change_inserted 880794617 1542301018
manually 
\change_unchanged
designing a sampling method that simultaneously place
\change_inserted 880794617 1542301029
s
\change_unchanged
 all 
\begin_inset Formula $38$
\end_inset

 particles and achieve
\change_inserted 880794617 1542301030
s
\change_unchanged
 low energies appears unfeasible.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Would be nice to illustrate how simple-minded configuration generation results
 in energies that are orders of magnitude too high.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Make sure that it is understood that the main ingredient to training is
 the energy.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
We train a Boltzmann Generator to sample low-energy configurations in 
\begin_inset Quotes eld
\end_inset

one-shot
\begin_inset Quotes erd
\end_inset

 and use it in order to compute the free energy profiles of opening / closing
 the dimer.
 The training is initialized with examples from separate, disconnected simulatio
ns of the open and closed states, but in later stages, mostly training by
 energy (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:main_loss_KL"
plural "false"
caps "false"
noprefix "false"

\end_inset

) is used.
 A restraint keeps the bistable particle dimer centered and aligned in the
 simulation box, therefore the 
\begin_inset Formula $x$
\end_inset

-position of each dimer particle indicates if we are in the open or closed
 state (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:particle_dimer"
plural "false"
caps "false"
noprefix "false"

\end_inset

d).
 The trained Boltzmann Generator has learned a transformation of the complex
 configuration space density to a compact, 76-dimensional ball in latent
 space (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:particle_dimer"
plural "false"
caps "false"
noprefix "false"

\end_inset

e).
 Direct sampling of from 76-dimensional Gaussian in latent space and transformat
ion via 
\begin_inset Formula $F_{zx}$
\end_inset

 generates configurations where all particles are placed without significant
 clashes, and potential energies that overlap with the energy distribution
 of the unbiased MD trajectories (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:particle_dimer"
plural "false"
caps "false"
noprefix "false"

\end_inset

f-h).
 Also, realistic transition states that have not been included in any training
 data are sampled (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:particle_dimer"
plural "false"
caps "false"
noprefix "false"

\end_inset

g).
 
\end_layout

\begin_layout Standard
We estimate that the MD simulation needs at least 
\begin_inset Formula $10^{12}$
\end_inset

 steps to spontaneously see a 
\change_inserted 880794617 1542208728
single 
\change_unchanged
transition from closed to open state and back (SI)
\change_inserted 880794617 1542209182
, and about 
\begin_inset Formula $100$
\end_inset

 such transitions would be needed to compute free energy differences with
 the precision of Boltzmann Generators shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:particle_dimer"
plural "false"
caps "false"
noprefix "false"

\end_inset

i
\change_unchanged
.
 The 
\change_inserted 880794617 1542209169
total effort to train the 
\change_unchanged
Boltzmann generator 
\change_inserted 880794617 1542301048
is about 
\begin_inset Formula $3\cdot10^{7}$
\end_inset

 energy evaluations, but then statistically independent samples can be drawn
 at the entire temperature range trained at, resulting in about 
\begin_inset Formula $7$
\end_inset

 orders of magnitude speedup compared to MD.
\change_unchanged

\end_layout

\begin_layout Standard
To demonstrate that thermodynamic quantities can be computed with Boltzmann
 Generators, we perform the training by energy (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:main_loss_KL"
plural "false"
caps "false"
noprefix "false"

\end_inset

) simultaneously to a range of temperatures between one fourth and four
 times the reference temperature (SI).
 
\change_inserted 880794617 1542300773
Here, we exploit that the temperature, which changes the configuration space
 distribution in a complex way, simply enters as a scaling factor in the
 width of the Gaussian 
\begin_inset Formula $q_{Z}(\mathbf{z})$
\end_inset

 (SI).
 
\change_unchanged
Then, we sample the Boltzmann Generator for a range of temperatures and
 use simple reweighting to compute the free energies along the dimer distances.
 As shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:particle_dimer"
plural "false"
caps "false"
noprefix "false"

\end_inset

i, these temperature-dependent free energies agree precisely with extensive
 umbrella sampling simulations that employ bias potentials along the dimer
 distance 
\begin_inset CommandInset citation
LatexCommand cite
key "Torrie_JCompPhys23_187"
literal "false"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/Fig_Results_Particles.pdf
	lyxscale 70
	width 80text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:particle_dimer"

\end_inset


\change_inserted 880794617 1542301071

\series bold
Repulsive p
\change_unchanged
article System with bistable dimer.

\series default
 
\series bold
a,b)
\series default
 Closed (blue) and open (red) configurations from MD simulations (input
 data).
 
\series bold
c)
\series default
 Bistable dimer potential.
 
\series bold
d)
\series default
 Distribution of 
\change_inserted 880794617 1542301092
MD simulation
\change_unchanged
 data on 
\begin_inset Formula $x_{1},x_{2}$
\end_inset

.
 e) Distribution of 
\change_inserted 880794617 1542301080
MD simulation
\change_unchanged
 data 
\change_inserted 880794617 1542301110
in latent space coordinates
\change_unchanged
 
\begin_inset Formula $z_{1},z_{2}$
\end_inset

 after training
\change_inserted 880794617 1542301121
 Boltzmann Generator
\change_unchanged
.
 
\series bold
f, g, h)
\series default
 Potential energy distribution from MD (colored) and Boltzmann generator
 (grey) for closed (f), open (h) and transition configurations (g).
 Insets show one-shot samples from Boltzmann generator.
 
\series bold
i)
\series default
 Free energy differences as a function of dimer distance and 
\change_inserted 880794617 1542301131
relative 
\change_unchanged
temperature sampled with Boltzmann generators (one-shot generation and reweighti
ng, bullets with error bars indicating one standard deviation) and umbrella
 sampling (green lines).
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Finally, we demonstrate that Boltzmann Generators can sample complex polymer
 structures in 
\begin_inset Quotes eld
\end_inset

one shot
\begin_inset Quotes erd
\end_inset

 that belong to known or new metastable states.
 Cyclical polymers are especially challenging, because the main degrees
 of freedom are torsion angles, but for each change of a torsion, other
 torsions must be changed concurrently so as to maintain ring closure and
 all bond angle constraints.
 Sophisticated Monte Carlo moves have been designed for this purpose 
\begin_inset CommandInset citation
LatexCommand cite
key "GoScheraga_Macromolecules70_RingClosure"
literal "false"

\end_inset

, but they generally do not yield MCMC procedures that sample the Boltzmann
 distribution.
\end_layout

\begin_layout Standard
Here we using cycical hydrocarbons as example.
 Each hydrocarbon torsion angle has three rotamers (around 
\begin_inset Formula $-60°$
\end_inset

, 
\begin_inset Formula $60°$
\end_inset

, 
\begin_inset Formula $180°$
\end_inset

)
\change_inserted 880794617 1542301140
, and we use 
\begin_inset Quotes eld
\end_inset

rotamer state
\begin_inset Quotes erd
\end_inset

 to denote the setting of all rotamers in the polymer
\change_unchanged
.
 The cycle constraints stabilize some otherwise unstable conformations but
 generally reduce the total number of accessible 
\change_inserted 880794617 1542209358
rotamer states.

\change_unchanged
 For cyclononane (
\begin_inset Formula $C_{9}H_{18}$
\end_inset

), we used a combination of training by energy and training by example,
 the latter initialized with a short replica-exchange MD simulation in which
 4 distinct rotamer
\change_inserted 880794617 1542209363
 states
\change_unchanged
 have been sampled.
 We then use a Boltzmann Generator for iterative discovery: In each iteration,
 the Boltzmann generator samples structures from known 
\change_inserted 880794617 1542209437
rotamer states
\change_unchanged
, and also a small fraction of structures from new 
\change_inserted 880794617 1542209371
rotamer states.

\change_unchanged
 We sample 
\change_inserted 880794617 1542301145
an equal number of configurations from each rotamer state found, and re-insert
 
\change_unchanged
these samples for training by example in the next round (SI).
 A so-trained Boltzmann Generator quickly produces structures not included
 in the initial MD data (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:hydrocarbon"
plural "false"
caps "false"
noprefix "false"

\end_inset

a, e-j).
 Potential energies 
\change_inserted 880794617 1542301151
of
\change_unchanged
 generated structures have a high overlap with the potential energy sampled
 in the MD simulation (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:hydrocarbon"
plural "false"
caps "false"
noprefix "false"

\end_inset

b).
 Note that all atoms – including hydrogens – are generated in one shot.
 Nonetheless, the bond lengths and bond angles follow their equilibrium
 distribution closely (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:hydrocarbon"
plural "false"
caps "false"
noprefix "false"

\end_inset

c,d).
 
\end_layout

\begin_layout Standard
Finally, one-shot samples were generated for bicyclo[4.4.4]tetradecane 
\begin_inset Formula $C_{14}H_{26}$
\end_inset

, a highly constrained and densely packed hydrocarbone with two interconnected
 ring systems and 120 dimensions (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:hydrocarbon"
plural "false"
caps "false"
noprefix "false"

\end_inset

k,l and insets).
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/Fig_Results_Hydrocarbons.pdf
	lyxscale 70
	width 80text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:hydrocarbon"

\end_inset


\change_inserted 880794617 1542301283

\series bold
Exploration of new states and o
\change_unchanged
ne-shot sampling of cyclical molecule structures
\series default
: Cyclononane 
\begin_inset Formula $C_{9}H_{18}$
\end_inset

 (a-j) and bicyclo[4.4.4]tetradecane 
\begin_inset Formula $C_{14}H_{26}$
\end_inset

 (k-l).
 
\series bold
a)
\series default
 Number of distinct rotamers sample
\change_inserted 880794617 1542301311
d
\change_unchanged
 with Boltzmann Generator that is initialized with MD data containing 
\change_inserted 880794617 1542301290
4
\change_unchanged
 rotamer
\change_inserted 880794617 1542301293
 states
\change_unchanged
.
 
\series bold
b)
\series default
 Potential energy distribution.
 
\series bold
c-d)
\series default
 Generated bond length and angle distribution compared to MD data.
 
\series bold
e-g)
\series default
 One-shot Boltzmann-generated structures (black) and the most similar structures
 from replica-exchange MD (red).
 
\series bold
h-j)
\series default
 One-shot Boltzmann-generated structures that are not contained in the MD
 simulations.
 
\series bold
k-l)
\series default
 One-shot Boltzmann-generated structures of bicyclo[4.4.4]tetradecane 
\begin_inset Formula $C_{14}H_{26}$
\end_inset

 – side-view is shown in large, top view below as ball+stick and space-filling
 representation.
 The three chains are colored for better visibility, the connecting carbons
 are kept dark.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Section

\series bold
Conclusions
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Boltzmann Generators are, as yet, the first approach that can sample the
 Boltzmann distribution and generate structures of condensed matter systems
 and complex polymers directly, i.e.
 by avoiding to make small MD or MCMC steps.
 We have demonstrated this for systems with around 100 dimensions.
 Although we expect the methodology to improve rapidly, we believe that
 for very high-dimensional systems, such as solvated atomistic protein models
 with 100,000's of dimensions, the best strategy is to employ Boltzmann
 Generators for 
\change_inserted 880794617 1542301177
so-called cluster 
\change_unchanged
Monte Carlo moves.
 
\change_inserted 880794617 1542301263
In each iteration of this approach, one would re-sample the positions of
 a cluster of atoms using the sum of potential energies between cluster
 atoms and all system atoms.
 
\change_unchanged
With such a strategy, Boltzmann Generators can be naturally combined with
 existing local sampling methods.
\end_layout

\begin_layout Standard
The present work shows that Boltzmann Generators can sample the Boltzmann
 distribution of complex systems in one shot and may offer a way out of
 the sampling problem in condensed matter systems.
 The limitation of the current work is that the transformation that achieves
 this needs to be trained using the system-specific energy.
 In order to make the approach general, it needs to be
\change_inserted 880794617 1542301332
come
\change_unchanged
 transferrable across systems, and a promising route is to employ transferrable
 featurization methods developed in the context of Machine Learning for
 Quantum Mechanics 
\begin_inset CommandInset citation
LatexCommand cite
key "BehlerParrinello_PRL07_NeuralNetwork,RuppEtAl_PRL12_QML"
literal "false"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{0.5cm}
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\series bold
References and Notes:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
vspace{-1.5cm}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
btprint "btPrintCited"
bibfiles "/Users/noe/data/my_papers/bib/all,/Users/noe/data/my_papers/bib/own"
biblatexopts "title={$\\:$}"

\end_inset


\end_layout

\begin_layout Paragraph
Acknowledgements:
\end_layout

\begin_layout Standard
FN acknowledges funding from European Commission (ERC CoG 772230 
\begin_inset Quotes eld
\end_inset

ScaleCell
\begin_inset Quotes erd
\end_inset

), Deutsche Forschungsgemeinschaft (CRC1114/A04), and the MATH
\begin_inset Formula $^{+}$
\end_inset

 research cluster (AA1x8, EF1x2).

\change_inserted 880794617 1542209474
 We are grateful to Cecilia Clementi (Rice) and Brooke Husic (FU Berlin)
 for valuable comments and discussions.
\change_unchanged

\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Section*
Supplementary Material
\end_layout

\begin_layout Subsection*
A.
 Invertible networks
\end_layout

\begin_layout Standard
We employ invertible networks in order to learn the transformation between
 the Gaussian random variables 
\begin_inset Formula $\mathbf{z}$
\end_inset

 and the Boltzmann-distributed random variables 
\begin_inset Formula $\mathbf{x}$
\end_inset

:
\begin_inset Formula 
\begin{align*}
\mathbf{z} & =F_{xz}(\mathbf{x};\boldsymbol{\theta})\\
\mathbf{x} & =F_{zx}(\mathbf{z};\boldsymbol{\theta}).
\end{align*}

\end_inset

Hence 
\begin_inset Formula $T_{xz}=T_{zx}^{-1}$
\end_inset

.
 Note that the set of parameters 
\begin_inset Formula $\boldsymbol{\theta}$
\end_inset

 defining these transformations are identical (shared) between the forward
 and backward transformations.
 Each transformation has a Jacobian matrix with the pairwise first derivatives
 of outputs with respect to inputs:
\begin_inset Formula 
\begin{align*}
\mathbf{J}_{zx}(\mathbf{z};\boldsymbol{\theta}) & =\left[\frac{\partial F_{zx}(\mathbf{z};\boldsymbol{\theta})}{\partial z_{1}},...,\frac{\partial F_{zx}(\mathbf{z};\boldsymbol{\theta})}{\partial z_{n}}\right]\\
\mathbf{J}_{xz}(\mathbf{x};\boldsymbol{\theta}) & =\left[\frac{dF_{xz}(\mathbf{x};\boldsymbol{\theta})}{dx_{1}},...,\frac{dF_{xz}(\mathbf{x};\boldsymbol{\theta})}{dx_{n}}\right]
\end{align*}

\end_inset

The absolute value of the Jacobian's determinant, 
\begin_inset Formula $\left|\det\mathbf{J}_{zx}(\mathbf{z};\boldsymbol{\theta})\right|$
\end_inset

, measures how much a volume element at 
\begin_inset Formula $\mathbf{z}$
\end_inset

 is scaled by the transformation.
 Forward and reverse transformation are related by 
\begin_inset Formula $\left|\det\mathbf{J}_{zx}(\mathbf{z};\boldsymbol{\theta})\right|=\left|\det\mathbf{J}_{xz}(\mathbf{x})\right|^{-1}$
\end_inset

, and respectively for 
\begin_inset Formula $\mathbf{x}$
\end_inset

 and 
\begin_inset Formula $\mathbf{z}$
\end_inset

 exchanged.
 As we frequently deal with Jacobian determinants, we introduce the abbreviation
s:
\begin_inset Formula 
\begin{align*}
R_{xz}(\mathbf{x}) & =\left|\det\mathbf{J}_{xz}(\mathbf{x})\right|\\
R_{zx}(\mathbf{z}) & =\left|\det\mathbf{J}_{zx}(\mathbf{z})\right|.
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
Our main motivation to use invertible transformations is that they allow
 us to transform random variables as follows:
\begin_inset Formula 
\begin{align}
p_{X}(\mathbf{x}) & =p_{Z}(\mathbf{z})\left|\det\mathbf{J}_{zx}(\mathbf{z})\right|^{-1}\nonumber \\
 & =p_{Z}(T_{xz}(\mathbf{x}))\left|\det\mathbf{J}_{xz}(\mathbf{x})\right|\label{eq:transform_zx}\\
p_{Z}(\mathbf{z}) & =p_{X}(\mathbf{x})\left|\det\mathbf{J}_{xz}(\mathbf{x})\right|^{-1}\nonumber \\
 & =p_{X}(T_{zx}(\mathbf{z}))\left|\det\mathbf{J}_{zx}(\mathbf{z})\right|\label{eq:transform_xz}
\end{align}

\end_inset


\color red

\begin_inset Note Note
status open

\begin_layout Plain Layout

\series bold
Hao
\series default
\color red
: This possibly leads to confusion of notations.
 In Appendix B, 
\begin_inset Formula $p_{X}$
\end_inset

 and 
\begin_inset Formula $p_{Z}$
\end_inset

 are not coupled as the above.
\end_layout

\end_inset


\color inherit
Here we employ the invertible network structures NICE 
\begin_inset CommandInset citation
LatexCommand cite
key "DinhDruegerBengio_NICE2015"
literal "false"

\end_inset

 and RealNVP 
\begin_inset CommandInset citation
LatexCommand cite
key "DinhBengio_RealNVP"
literal "false"

\end_inset

.
 The main idea is to split the variables into two channels, 
\begin_inset Formula $\mathbf{x}=(\mathbf{x}_{1},\mathbf{x}_{2})$
\end_inset

 and 
\begin_inset Formula $\mathbf{z}=(\mathbf{z}_{1},\mathbf{z}_{2})$
\end_inset

, do only trivially invertible operations on each channel, such as multiplicatio
n and addition, and use trainable, nonlinear neural network transformations
 between the channels to compute the value of these multiplication and addition
 transformations (Suppl.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_network-architecture"
plural "false"
caps "false"
noprefix "false"

\end_inset

b-e).
 
\end_layout

\begin_layout Standard
Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Invertible-network-components"
plural "false"
caps "false"
noprefix "false"

\end_inset

 summarizes the transformations employed here, their inverses and Jacobian
 determinant values.
 A single transformation of 
\begin_inset Formula $(\mathbf{z}_{1},\mathbf{z}_{2})=f_{xz}(\mathbf{x}_{1},\mathbf{x}_{2})$
\end_inset

, where 
\begin_inset Formula $T_{xz}$
\end_inset

 is implement via NICE or RealNVP transforms only the second channel and
 leaves the first channel unchanged.
 In order to allow all variables to be transformed, we swap channels in
 the next transformation (Suppl.
 Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_network-architecture"
plural "false"
caps "false"
noprefix "false"

\end_inset

f), and define a NICE or RealNVP block as:
\begin_inset Formula 
\begin{align*}
(\mathbf{y}_{1},\mathbf{y}_{2}) & =f_{xy}(\mathbf{x}_{1},\mathbf{x}_{2})\\
(\mathbf{z}_{1},\mathbf{z}_{2}) & =f_{yz}(\mathbf{y}_{2},\mathbf{y}_{1})
\end{align*}

\end_inset

Boltzmann Generators are build by putting the forward and the inverse of
 such blocks in parallel (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:illustration"
plural "false"
caps "false"
noprefix "false"

\end_inset

f).
 The forward and the inverse transformation in each layer share the same
 nonlinear transformation (
\begin_inset Formula $T$
\end_inset

 or 
\begin_inset Formula $S$
\end_inset

), and therefore the same parameters.
\end_layout

\begin_layout Standard
The NICE transformation is volume-preserving.
 As such, it also preserves the entropy 
\begin_inset Formula $H_{X}=\int p(\mathbf{x})\log p(\mathbf{x})\:\mathrm{d}\mathbf{x}$
\end_inset

.
 In order to be able to model probability distributions with arbitrary entropy,
 we need to insert at least one scaling layer into a Boltzmann Generator
 that otherwise only contains NICE layers.
\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/network_structure2.pdf
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig_network-architecture"

\end_inset


\series bold
Boltzmann Generator network architecture.

\series default
 
\series bold
a)
\series default
 Nonlinear transformations 
\begin_inset Formula $T$
\end_inset

 and 
\begin_inset Formula $S$
\end_inset

 are built with multilayer neural networks.
 
\series bold
b,c)
\series default
 Volume-preserving NICE layer and its inverse.
 
\series bold
d,e)
\series default
 Non-volume-preserving RealNVP layer and its inverse.
 
\series bold
f)
\series default
 Stacking any sequence of these layers with channels exchanges produces
 the full Boltzmann Generator, and invertible network.
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
CC: Too much detail.
 Put b-e in the SI.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="5">
<features tabularvalignment="middle">
<column alignment="left" valignment="top" width="1.5cm">
<column alignment="left" valignment="top" width="4.5cm">
<column alignment="left" valignment="top">
<column alignment="left" valignment="top" width="4.5cm">
<column alignment="left" valignment="top" width="0pt">
<row topspace="0.2cm" bottomspace="0.2cm">
<cell alignment="left" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Layer
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $f_{xz}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\left|\det\mathbf{J}_{xz}\right|$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $f_{zx}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\left|\det\mathbf{J}_{zx}\right|$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topspace="0.2cm" bottomspace="0.2cm">
<cell alignment="left" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
NICE
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\begin{array}{cl}
\mathbf{z}_{1}= & \mathbf{x}_{1}\\
\mathbf{z}_{2}= & \mathbf{x}_{2}+T(\mathbf{x}_{1};\boldsymbol{\theta})
\end{array}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\begin{array}{cl}
\mathbf{x}_{1} & =\mathbf{z}_{1}\\
\mathbf{x}_{2} & =\mathbf{z}_{2}-T(\mathbf{y}_{1};\boldsymbol{\theta})
\end{array}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topspace="0.2cm" bottomspace="0.2cm">
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Scaling, Exp
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hspace{0.2cm}
\end_layout

\end_inset


\begin_inset Formula $\mathbf{z}=\mathrm{e}^{\mathbf{k}}\circ\mathbf{x}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{e}^{\sum_{i}k_{i}}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hspace{0.2cm}
\end_layout

\end_inset


\begin_inset Formula $\mathbf{x}=\mathrm{e}^{-\mathbf{k}}\circ\mathbf{z}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{e}^{-\sum_{i}k_{i}}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topspace="0.2cm" bottomspace="0.2cm">
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
RealNVP
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\begin{array}{cl}
\mathbf{z}_{1} & =\mathbf{x}_{1}\\
\mathbf{z}_{2} & =\mathbf{x}_{2}\odot\exp\left(S(\mathbf{x}_{1};\boldsymbol{\theta})\right)\\
 & \:\:\:+T(\mathbf{x}_{1};\boldsymbol{\theta})
\end{array}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{e}^{\sum_{i}S_{i}(\mathbf{x}_{1};\boldsymbol{\theta})}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\begin{array}{cl}
\mathbf{x}_{1} & =\mathbf{z}_{1}\\
\mathbf{x}_{2} & =\left(\mathbf{z}_{2}-T(\mathbf{x}_{1};\boldsymbol{\theta})\right)\\
 & \:\:\:\odot\exp\left(-S(\mathbf{z}_{1};\boldsymbol{\theta})\right)
\end{array}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{e}^{-\sum_{i}S_{i}(\mathbf{z}_{1};\boldsymbol{\theta})}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Invertible-network-components"

\end_inset

Invertible network components.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection*
B.
 Training and using Boltzmann Generators
\end_layout

\begin_layout Standard
The Boltzmann Generator is trained by minimizing a loss functional that
 has the following form:
\begin_inset Formula 
\[
J=w_{ML}J_{ML}+w_{KL}J_{KL}+w_{RC}J_{RC}.
\]

\end_inset

where the terms represent maximum-likelihood (ML, 
\begin_inset Quotes eld
\end_inset

training by example
\begin_inset Quotes erd
\end_inset

), Kullback-Leiber (KL, 
\begin_inset Quotes eld
\end_inset

training by energy
\begin_inset Quotes erd
\end_inset

), and reaction-coordinate (RC) optimization and the 
\begin_inset Formula $w$
\end_inset

's control their weights.
 Below we will derive these terms in detail.
 
\end_layout

\begin_layout Standard
We call the 
\begin_inset Quotes eld
\end_inset

exact
\begin_inset Quotes erd
\end_inset

 distributions 
\begin_inset Formula $\mu$
\end_inset

 and the generated distributions 
\begin_inset Formula $q$
\end_inset

.
 In particular, 
\begin_inset Formula $\mu_{Z}(\mathbf{z})$
\end_inset

 is the Gaussian prior distribution injected into the latent space and 
\begin_inset Formula $q_{X}(\mathbf{x})$
\end_inset

 is the distribution that results from the network transformation 
\begin_inset Formula $F_{zx}$
\end_inset

.
 Likewise, 
\begin_inset Formula $\mu_{X}(\mathbf{x})\propto\exp(-u(\mathbf{x}))$
\end_inset

 is the Boltzmann distribution in configuration space and 
\begin_inset Formula $q_{Z}(\mathbf{z})$
\end_inset

 is the distribution that results from the network transformation 
\begin_inset Formula $F_{xz}$
\end_inset

:
\begin_inset Formula 
\begin{eqnarray*}
\mu_{Z}(\mathbf{z}) & \overset{F_{zx}}{\longrightarrow} & q_{X}(\mathbf{x})\\
\mu_{X}(\mathbf{x}) & \overset{F_{xz}}{\longrightarrow} & q_{Z}(\mathbf{z})
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard

\series bold
Boltzmann distribution
\series default
: A special case is to use Boltzmann Generators to sample from the Boltzmann
 distribution of the canonical ensemble.
 This distribution has the form:
\begin_inset Formula 
\begin{equation}
\mu_{X}(\mathbf{x})=Z_{X}^{-1}\mathrm{e}^{-\beta U(\mathbf{x})}\label{eq:Boltzmann_distribution}
\end{equation}

\end_inset

where 
\begin_inset Formula $\beta^{-1}=k_{B}T$
\end_inset

 with Boltzmann constant 
\begin_inset Formula $k_{B}$
\end_inset

 and temperature 
\begin_inset Formula $T$
\end_inset

.
 When we only have one temperature, we can simply subsume the constant into
 a reduced energy
\begin_inset Formula 
\[
u(\mathbf{x})=\frac{U(\mathbf{x})}{k_{B}T}
\]

\end_inset

In order to evaluate a set of temperatures 
\begin_inset Formula $(T^{1},...,T^{K})$
\end_inset

, we can define a reference temperature 
\begin_inset Formula $T^{0}$
\end_inset

 and the respective reduced energy 
\begin_inset Formula $u^{0}(\mathbf{x})=U(\mathbf{x})/k_{B}T^{0}$
\end_inset

 and we then obtain the reduced energies simply by scaling:
\begin_inset Formula 
\[
u^{k}(\mathbf{x})=\frac{T^{0}}{T^{k}}u^{0}(\mathbf{x})=\frac{u^{0}(\mathbf{x})}{\tau_{k}}
\]

\end_inset

where 
\begin_inset Formula $\tau_{k}$
\end_inset

 is the relative temperature.
\end_layout

\begin_layout Standard

\series bold
Prior distribution
\series default
: We sample the input in 
\begin_inset Formula $\mathbf{z}$
\end_inset

 from the isotropic Gaussian distribution:
\begin_inset Formula 
\begin{equation}
\mu_{Z}^{k}(\mathbf{z})=\mathcal{N}(\mathbf{0},\sigma_{k}^{2}\mathbf{I})=Z_{Z}^{-1}\mathrm{e}^{-\frac{1}{2}\left\Vert \mathbf{z}\right\Vert ^{2}/\sigma_{k}^{2}},\label{eq:z_Gaussian_prior}
\end{equation}

\end_inset

with normalization constant 
\begin_inset Formula $Z_{Z}$
\end_inset

.
 The prior energy, i.e.
 the energy whose Boltzmann distribution is the prior distribution, is given
 by: 
\begin_inset Formula 
\begin{align}
u_{Z}^{k}(\mathbf{z}) & =-\log\mu_{Z}^{k}(\mathbf{z})\nonumber \\
 & =\frac{1}{2\sigma_{k}^{2}}\left\Vert \mathbf{z}\right\Vert ^{2}+\mathrm{const}.\label{eq:z_Gaussian_energy}
\end{align}

\end_inset

Thus the variance takes the same role as the relative temperature.
 We define (arbitrarily) to set the variance equal 1 at the standard temperature
, and obtain: 
\begin_inset Formula 
\[
\sigma_{k}^{2}=\tau_{k}.
\]

\end_inset


\end_layout

\begin_layout Standard

\color red
\begin_inset Note Note
status open

\begin_layout Plain Layout

\series bold
Hao
\series default
\color red
: Is this 
\begin_inset Formula $\tau_{k}$
\end_inset

 the 
\color inherit
relative temperature
\color red
 in the above paragraph? If yes, the relationship holds only for NICE.
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph
Latent KL divergence
\end_layout

\begin_layout Standard
The KL divergence between two distributions 
\begin_inset Formula $q$
\end_inset

 and 
\begin_inset Formula $p$
\end_inset

 is given by
\begin_inset Formula 
\begin{align*}
\mathrm{KL}(q\parallel p) & =\int q(\mathbf{x})\left[\log q(\mathbf{x})-\log p(\mathbf{x})\right]\mathrm{d}\mathbf{x},\\
 & =-H_{q}-\int q(\mathbf{x})\log p(\mathbf{x})\mathrm{d}\mathbf{x},
\end{align*}

\end_inset

where 
\begin_inset Formula $H_{q}$
\end_inset

 is the entropy of the distribution 
\begin_inset Formula $q$
\end_inset

.
 
\end_layout

\begin_layout Standard
Here we use KL divergences to minimize the difference between the probability
 densities predicted by the Boltzmann generator and the respective reference
 distribution.
 Using the variable transformations (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:transform_zx"
plural "false"
caps "false"
noprefix "false"

\end_inset

-
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:transform_xz"
plural "false"
caps "false"
noprefix "false"

\end_inset

) and the Boltzmann distribution (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Boltzmann_distribution"
plural "false"
caps "false"
noprefix "false"

\end_inset

), we can express the KL divergence in latent space as:
\begin_inset Formula 
\begin{align*}
\mathrm{KL}_{\boldsymbol{\theta}}\left[\mu_{Z}\parallel q_{Z}\right] & =-H_{Z}-\int\mu_{Z}(\mathbf{z})\log q_{Z}(\mathbf{z};\boldsymbol{\theta})\mathrm{d}\mathbf{z},\\
 & =-H_{Z}-\int\mu_{Z}(\mathbf{z})\left[\log\mu_{X}(F_{zx}(\mathbf{z};\boldsymbol{\theta}))+\log\left|\det\mathbf{J}_{zx}(\mathbf{z};\boldsymbol{\theta})\right|\right]\mathrm{d}\mathbf{z},\\
 & =-H_{Z}+\log Z_{X}+\mathbb{E}_{\mathbf{z}\sim\mu_{Z}(\mathbf{z})}\left[u(F_{zx}(\mathbf{z};\boldsymbol{\theta}))-\log\left|\det\mathbf{J}_{zx}(\mathbf{z};\boldsymbol{\theta})\right|\right]
\end{align*}

\end_inset

This is equivalent to the KL divergence expressed in configuration space:
\begin_inset Formula 
\begin{align*}
\mathrm{KL}_{\boldsymbol{\theta}}\left[q_{X}\parallel\mu_{X}\right] & =\int q_{X}(\mathbf{x};\boldsymbol{\theta})\left[\log q_{X}(\mathbf{x};\boldsymbol{\theta})+\log Z_{X}+u(\mathbf{x})\right]\mathrm{d}\mathbf{x}\\
 & =\int\mu_{Z}(\mathbf{z})\left[\log\mu_{Z}(\mathbf{z})+\log\left|\det\mathbf{J}_{xz}(\mathbf{z};\boldsymbol{\theta})\right|+\log Z_{X}+u(F_{zx}(\mathbf{z};\boldsymbol{\theta}))\right]\mathrm{d}\mathbf{z}\\
 & =-H_{Z}+\log Z_{X}+\mathbb{E}_{\mathbf{z}\sim\mu_{Z}(\mathbf{z})}\left[u(F_{zx}(\mathbf{z};\boldsymbol{\theta}))-\log\left|\det\mathbf{J}_{zx}(\mathbf{z};\boldsymbol{\theta})\right|\right]
\end{align*}

\end_inset

Here, 
\begin_inset Formula $\boldsymbol{\theta}$
\end_inset

 are the trainable neural network parameters.
 Since 
\begin_inset Formula $H_{Z}$
\end_inset

 and 
\begin_inset Formula $Z_{X}$
\end_inset

 are constants in 
\begin_inset Formula $\boldsymbol{\theta}$
\end_inset

, the KL loss is given by:
\begin_inset Formula 
\begin{equation}
J_{KL}=\mathbb{E}_{\mathbf{z}\sim\mu_{Z}(\mathbf{z})}\left[u(F_{zx}(\mathbf{z};\boldsymbol{\theta}))-\log\left|\det\mathbf{J}_{zx}(\mathbf{z};\boldsymbol{\theta})\right|\right].\label{eq:loss_KL}
\end{equation}

\end_inset

Practically, each training batch samples points 
\begin_inset Formula $\mathbf{z}\sim q_{Z}(\mathbf{z})$
\end_inset

 from a normal distribution, transformes them via 
\begin_inset Formula $T_{zx}$
\end_inset

, and evaluates Eq.
 (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:loss_KL"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
\end_layout

\begin_layout Standard
We can extend (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:loss_KL"
plural "false"
caps "false"
noprefix "false"

\end_inset

) to simultaneously train at multiple temperatures, obtaining:
\begin_inset Formula 
\[
J_{KL}^{T^{1},...,T^{K}}=\sum_{k=1}^{K}\mathbb{E}_{\mathbf{z}\sim\mu_{Z}^{k}(\mathbf{z})}\left[u^{k}(F_{zx}(\mathbf{z};\boldsymbol{\theta}))-\log\left|\det\mathbf{J}_{zx}(\mathbf{z};\boldsymbol{\theta})\right|\right].
\]

\end_inset

The KL divergence 
\begin_inset Formula $\mathrm{KL}_{\boldsymbol{\theta}}\left[\mu_{Z}\parallel q_{Z}\right]$
\end_inset

 is also maximized in 
\emph on
probability density distillation
\emph default
 used in the training of recent audio generation networks 
\begin_inset CommandInset citation
LatexCommand cite
key "VanDenOord_WaveNet2"
literal "false"

\end_inset

.
 Here, the reference distribution is defined by a teacher network that is
 used to help training a student network.
 However, the resulting expressions are different because the target distributio
n is not defined by a physical energy as here.
 
\end_layout

\begin_layout Paragraph
Reweighting and interpretation of latent KL as reweighting loss
\end_layout

\begin_layout Standard
The most direct way to compute quantitative statistics using Boltzmann generator
s is to employ reweighting of probability densities.
 In this framework, we assign to each generated configuration 
\begin_inset Formula $\mathbf{x}$
\end_inset

 the statistical weight:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align}
w_{X}(\mathbf{x}) & =\frac{\mu_{X}(\mathbf{x})}{q_{X}(\mathbf{x})}=\frac{q_{Z}(\mathbf{z})}{\mu_{Z}(\mathbf{z})}.\label{eq:reweighting_w}\\
 & \propto\mathrm{e}^{-u_{X}\left(T_{zx}(\mathbf{z})\right)+u_{Z}(\mathbf{z})+\log\left|\det\left(\mathbf{J}_{zx}(\mathbf{z})\right)\right|}\nonumber 
\end{align}

\end_inset

where the equivalence on the right hand side results from (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:transform_zx"
plural "false"
caps "false"
noprefix "false"

\end_inset

-
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:transform_xz"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
 Using these weights, expectation values can be computed as
\begin_inset Formula 
\[
\mathbb{E}[O]\approx\frac{\sum_{i=1}^{N}w_{X}(\mathbf{x})O(\mathbf{x})}{\sum_{i=1}^{N}w_{X}(\mathbf{x})}.
\]

\end_inset


\end_layout

\begin_layout Standard
With the reweighting (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:reweighting_w"
plural "false"
caps "false"
noprefix "false"

\end_inset

), the KL loss (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:loss_KL"
plural "false"
caps "false"
noprefix "false"

\end_inset

) has an interesting thermodynamic interpretation.
 The minimization of the latent KL divergence can be rewritten in terms
 of these weights:
\begin_inset Formula 
\begin{align*}
\min\mathrm{KL}_{\boldsymbol{\theta}}\left[\mu_{Z}\parallel q_{Z}\right] & =\min\mathbb{E}_{\mathbf{z}\sim\mu_{Z}(\mathbf{z})}\left[\log\mu_{Z}(\mathbf{z})-\log q_{Z}(\mathbf{z};\boldsymbol{\theta})\right]\\
 & =\max\mathbb{E}_{\mathbf{z}\sim\mu_{Z}(\mathbf{z})}\left[\log w_{X}(\mathbf{x}\mid\mathbf{z})\right].
\end{align*}

\end_inset

Thus, the minimization of the latent KL divergence is equivalent to maximizing
 the expected log-weights of points, or equivalently the product of all
 weights, in a reweighting procedure.
 Indeed the maximum weights are achieved when the proposal distribution
 is identical to the Boltzmann distribution, resulting in 
\begin_inset Formula $w_{X}(\mathbf{x})\equiv1$
\end_inset

.
 
\end_layout

\begin_layout Paragraph
Interpretation of latent KL as free energy
\end_layout

\begin_layout Standard
For invertible transformation 
\begin_inset Formula $F_{xz}$
\end_inset

, we additionally use the following relationship of the entropies of the
 two distributions:
\begin_inset Formula 
\begin{align}
H_{X} & =-\int_{\mathbf{x}}q_{X}(\mathbf{x})\log q_{X}(\mathbf{x})\:\mathrm{d}\mathbf{x}\nonumber \\
 & =-\int_{\mathbf{z}}q_{X}(F_{zx}(\mathbf{z}))\log q_{X}(F_{zx}(\mathbf{z}))\left|\det\mathbf{J}_{zx}(\mathbf{z})\right|\:\mathrm{d}\mathbf{z}\nonumber \\
 & =-\int_{\mathbf{z}}\mu_{Z}(\mathbf{z})\log q_{X}(F_{zx}(\mathbf{z}))\:\mathrm{d}\mathbf{z}\nonumber \\
 & =-\int_{\mathbf{z}}\mu_{Z}(\mathbf{z})\log\left(\mu_{Z}(\mathbf{z})\left|\det\mathbf{J}_{zx}(\mathbf{z})\right|^{-1}\right)\:\mathrm{d}\mathbf{z}\nonumber \\
 & =-\int_{\mathbf{z}}\mu_{Z}(\mathbf{z})\log\mu_{Z}(\mathbf{z})\:\mathrm{d}\mathbf{z}+\mathbb{E}_{\mathbf{z}\sim\mu_{Z}(\mathbf{z})}\log\left|\det\mathbf{J}_{zx}(\mathbf{z})\right|\:\mathrm{d}\mathbf{z}\nonumber \\
 & =H_{Z}+\mathbb{E}_{\mathbf{z}\sim\mu_{Z}(\mathbf{z})}\left[\log\left|\det\mathbf{J}_{zx}(\mathbf{z})\right|\right]\label{eq:entropy_difference}
\end{align}

\end_inset

Hence we have:
\begin_inset Formula 
\begin{align*}
\mathrm{KL}_{\boldsymbol{\theta}}\left[\mu_{Z}\parallel q_{Z}\right] & =-H_{Z}+\log Z_{X}+\mathbb{E}_{\mathbf{z}\sim\mu_{Z}(\mathbf{z})}\left[u(F_{zx}(\mathbf{z};\boldsymbol{\theta}))\right]-\mathbb{E}_{\mathbf{z}\sim\mu_{Z}(\mathbf{z})}\left[\log\left|\det\mathbf{J}_{zx}(\mathbf{z};\boldsymbol{\theta})\right|\right]\\
 & =-H_{X}+\log Z_{X}+\mathbb{E}_{\mathbf{z}\sim\mu_{Z}(\mathbf{z})}\left[u(F_{zx}(\mathbf{z};\boldsymbol{\theta}))\right]\\
 & =-H_{X}+\log Z_{X}+\mathbb{E}_{\mathbf{x}\sim\mu_{X}(\mathbf{x};\boldsymbol{\theta})}\left[u(\mathbf{x})\right]\\
 & =\mathrm{KL}_{\boldsymbol{\theta}}\left[q_{X}\parallel\mu_{X}\right].
\end{align*}

\end_inset

The loss function becomes:
\begin_inset Formula 
\begin{align*}
J_{KL} & =\mathbb{E}_{\mathbf{z}\sim\mu_{Z}(\mathbf{z})}\left[u(F_{zx}(\mathbf{z};\boldsymbol{\theta}))-\log\left|\det\mathbf{J}_{zx}(\mathbf{z};\boldsymbol{\theta})\right|\right]\\
 & =U-H_{X}+H_{Z}
\end{align*}

\end_inset


\change_inserted 880794617 1542276074
which is, up to the constant 
\begin_inset Formula $H_{Z}$
\end_inset

 equal to the free energy of the generated distribution 
\change_unchanged
with enthalpy 
\begin_inset Formula $U$
\end_inset

 and 
\change_inserted 880794617 1542276124
entropic factor 
\begin_inset Formula $H_{X}$
\end_inset

.
 Note that this entropic factor is taken at the temperature used for generating
 the distribution, a temperature dependence will enter when training the
 Boltzmann Generator at multiple temperatures.
\change_unchanged

\end_layout

\begin_layout Paragraph
Configuration KL divergence 
\end_layout

\begin_layout Standard
Likewise, we can express the KL divergence in 
\begin_inset Formula $\mathbf{x}$
\end_inset

 space where we compare the generated distributions with a Boltzmann weight.
 Using (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:transform_zx"
plural "false"
caps "false"
noprefix "false"

\end_inset

-
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:transform_xz"
plural "false"
caps "false"
noprefix "false"

\end_inset

) and the Gaussian prior density (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:z_Gaussian_prior"
plural "false"
caps "false"
noprefix "false"

\end_inset

), this KL-divergences evaluates as:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\mathrm{KL}_{\boldsymbol{\theta}}\left[\mu_{X}\parallel q_{X}\right] & =H_{X}-\int\mu_{X}(\mathbf{x})\log q_{X}(\mathbf{x};\boldsymbol{\theta})\mathrm{d}\mathbf{x}\\
 & =H_{X}-\int\mu_{X}(\mathbf{x})\left[\log\mu_{Z}(F_{xz}(\mathbf{x};\boldsymbol{\theta}))+\log\left|\mathbf{J}_{xz}(\mathbf{z};\boldsymbol{\theta})\right|\right]\mathrm{d}\mathbf{x}.\\
 & =H_{X}+\log Z_{Z}+\mathbb{E}_{\mathbf{x}\sim\mu(\mathbf{x})}\left[\frac{1}{\sigma^{2}}\left\Vert F_{xz}(\mathbf{x};\boldsymbol{\theta})\right\Vert ^{2}-\log\left|\mathbf{J}_{xz}(\mathbf{x};\boldsymbol{\theta})\right|\right].
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
Although the constants 
\begin_inset Formula $H_{X}$
\end_inset

 and 
\begin_inset Formula $Z_{Z}$
\end_inset

 can be ignored during the training, this loss is difficult to evaluate
 because it needs to sample configurations according to 
\begin_inset Formula $\mu(\mathbf{x})$
\end_inset

, which is actually the problem we are trying to solve.
 
\end_layout

\begin_layout Paragraph
Maximum Likelihood
\end_layout

\begin_layout Standard
However we can approximate the configuration KL divergence by starting from
 a sample 
\begin_inset Formula $\rho(\mathbf{x})$
\end_inset

 and using the loss:
\begin_inset Formula 
\begin{align*}
J_{ML} & =-\mathbb{E}_{\mathbf{x}\sim\rho(\mathbf{x})}\left[\log q_{X}(\mathbf{x};\boldsymbol{\theta})\right]\\
 & =\mathbb{E}_{\mathbf{x}\sim\rho(\mathbf{x})}\left[\frac{1}{\sigma^{2}}\left\Vert F_{xz}(\mathbf{x};\boldsymbol{\theta})\right\Vert ^{2}-\log\left|\mathbf{J}_{xz}(\mathbf{x};\boldsymbol{\theta})\right|\right]
\end{align*}

\end_inset

This loss is the negative log-likelihood, i.e.
 minimizing 
\begin_inset Formula $\mathrm{LL}_{\boldsymbol{\theta}}$
\end_inset

 corresponds to maximizing the likelihood of the sample 
\begin_inset Formula $\rho(\mathbf{x})$
\end_inset

 in the Gaussian prior density.
 
\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Multivariate 
\series bold
log-normal distribution
\series default
:
\begin_inset Formula 
\begin{align*}
\mathbf{y} & \sim\mathcal{N}(\mathbf{0},\sigma^{2}\mathbf{I})\\
\mathbf{z} & =e^{\mathbf{y}}
\end{align*}

\end_inset

Then we have the density:
\begin_inset Formula 
\begin{align*}
p(\mathbf{z}) & =\prod_{i=1}^{d}\frac{1}{\sigma z_{i}\sqrt{2\pi}}\mathrm{e}^{-\frac{(\log(z_{i}))^{2}}{2\sigma^{2}}}\\
 & =\frac{1}{\prod_{i=1}^{d}z_{i}}\frac{1}{(2\pi)^{d/2}\sigma^{d}}\mathrm{e}^{-\frac{1}{2\sigma^{2}}\sum_{i=1}^{d}(\log(z_{i}))^{2}}\\
u(z)=-\log p(z) & =\sum_{i=1}^{d}y_{i}+d\log\sigma+\frac{1}{2\sigma^{2}}\left\Vert \mathbf{y}\right\Vert ^{2}+\mathrm{const}
\end{align*}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Paragraph
Symmetric divergence
\end_layout

\begin_layout Standard
The two KL divergences above can be naturally combined to the symmetric
 divergence
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\mathrm{KL}_{\mathrm{sym}}=\frac{1}{2}\mathrm{KL}\left[\mu_{X}\parallel q_{X}\right]+\frac{1}{2}\mathrm{KL}\left[\mu_{Z}\parallel q_{Z}\right]
\]

\end_inset

which corresponds, up to an additive constant, to the Jensen-Shannon divergence
 which uses the geometric mean of 
\begin_inset Formula $m=\sqrt{q_{X}q_{Z}}$
\end_inset

 instead of the arithmetic mean.
 
\end_layout

\begin_layout Paragraph
Reaction coordinate loss
\end_layout

\begin_layout Standard
In some applications we do not want to sample from the Boltzmann distribution
 but promote the sampling of high-energy states in a specific direction
 of configuration space, for example in order to compute a free energy profile
 along a predefined reaction coordinate 
\begin_inset Formula $R(\mathbf{x})$
\end_inset

 (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

g).
 This is achieved by adding the reaction-coordinate (RC) loss to the minimizatio
n problem:
\begin_inset Formula 
\begin{align*}
J_{RC} & =\int p\left(R(\mathbf{x})\right)\log p\left(R(\mathbf{x})\right)\:\mathrm{d}R(\mathbf{x})\\
 & =\mathbb{E}_{\mathbf{x}\sim q_{X}(\mathbf{x})}\log p\left(R(\mathbf{x})\right).
\end{align*}

\end_inset

To implement this loss, the function 
\begin_inset Formula $R$
\end_inset

 is a user input, minimum and maximum bounds are given, and 
\begin_inset Formula $p\left(R(\mathbf{x})\right)$
\end_inset

 is computed as a batchwise kernel density estimate along between the bounds.
 
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
\begin_inset Formula 
\[
J_{XX}=\frac{1}{2}D_{KL}\left(p\parallel m\right)+\frac{1}{2}D_{KL}\left(q\parallel m\right)
\]

\end_inset

using
\begin_inset Formula 
\[
m=Z^{-1}\sqrt{pq}
\]

\end_inset

results in:
\begin_inset Formula 
\begin{align*}
J_{XX} & =\frac{1}{2}\int p(x)\left(\log p(x)-\log\sqrt{p(x)q(x)}\right)\\
 & +\frac{1}{2}\int q(x)\left(\log q(x)-\log\sqrt{p(x)q(x)}\right)-Z\\
 & =\frac{1}{2}\int p(x)\left(\log p(x)-\frac{1}{2}\log p(x)-\frac{1}{2}\log q(x)\right)\\
 & +\frac{1}{2}\int q(x)\left(\log q(x)-\frac{1}{2}\log p(x)-\frac{1}{2}\log q(x)\right)-Z\\
 & =\frac{1}{4}\int p(x)\left(\log p(x)-\log q(x)\right)\\
 & +\frac{1}{4}\int q(x)\left(\log q(x)-\log p(x)\right)-Z\\
 & =\frac{1}{4}D_{KL}\left(p\parallel q\right)+\frac{1}{4}D_{KL}\left(q\parallel p\right)-Z
\end{align*}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection*
C.
 Systems and Hyperparameters
\end_layout

\begin_layout Standard
The 
\begin_inset Quotes eld
\end_inset

MD
\begin_inset Quotes erd
\end_inset

 simulations of the systems below are not using actual dynamics, but are
 emulated with Metropolis Monte Carlo with small local steps.
 In each step, a random vector from an isotropic Gaussian distribution with
 a system-dependent standard deviation 
\begin_inset Formula $\sigma_{\mathrm{Metro}}$
\end_inset

 is added to the present configuration.
 This proposed configuration is accepted or rejected with a standard Metropolis
 acceptance criterion.
\end_layout

\begin_layout Standard
All Boltzmann Generator networks are build of invertible blocks using NICE
 or RealNVP layers.
 Each block contains two such layers to make sure that all dimensions are
 subject to a nonlinear transformation, as described in SI Section A.
 Each configuration 
\begin_inset Formula $\mathbf{x}$
\end_inset

 or latent vector 
\begin_inset Formula $\mathbf{z}$
\end_inset

 is split into a channel of 
\begin_inset Quotes eld
\end_inset

even
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

odd
\begin_inset Quotes erd
\end_inset

 dimensions, defining the pairs 
\begin_inset Formula $(\mathbf{x}_{1},\mathbf{x}_{2})$
\end_inset

 and 
\begin_inset Formula $(\mathbf{z}_{1},\mathbf{z}_{2})$
\end_inset

, respectively.
 To describe the network architecture used, we use 
\begin_inset Formula $N$
\end_inset

, 
\begin_inset Formula $R$
\end_inset

 and 
\begin_inset Formula $S$
\end_inset

 to denote NICE block, RealNVP block and Scaling layer, respectively.
 A subscript is used to denote the number of repetitions of a motif, e.g.
 
\begin_inset Formula $N_{10}$
\end_inset

 are ten stacked NICE blocks, i.e.
 20 layers total, 
\begin_inset Formula $(NR)_{4}$
\end_inset

 are four repetitions of a NICE and a RealNVP block, i.e.
 8 layers total.
\end_layout

\begin_layout Paragraph*
Double well
\end_layout

\begin_layout Standard
We define a two-dimensional toy model which is bistable in 
\begin_inset Formula $x$
\end_inset

-direction and harmonic in 
\begin_inset Formula $y$
\end_inset

-direction:
\begin_inset Formula 
\begin{equation}
E(x,y)=\frac{1}{4}ax^{4}-\frac{1}{2}bx^{2}+cx+\frac{1}{2}dy^{2}\label{eq:double_well_energy}
\end{equation}

\end_inset

with 
\begin_inset Formula $a=c=d=1$
\end_inset

 and 
\begin_inset Formula $b=6$
\end_inset

 – see Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

 for the potential in 
\begin_inset Formula $x$
\end_inset

-direction.
 The system is simulated with a Metropolis step of 
\begin_inset Formula $\sigma_{\mathrm{Metro}}=0.1$
\end_inset

.
 To estimate the average time needed for a return trip between both states,
 we construct another systems with 
\begin_inset Formula $a=0.25$
\end_inset

 and 
\begin_inset Formula $b=1.5$
\end_inset

 that has the same position of minima and the same energy difference between
 them, but a much smaller barrier.
 For the 
\begin_inset Quotes eld
\end_inset

flat
\begin_inset Quotes erd
\end_inset

 systems frequent transitions between the two end-states are observed.
 The return-trip time of the original system is then estimated by 
\begin_inset Formula $t=t_{\mathrm{flat}}\exp\left(B-B_{\mathrm{flat}}\right)$
\end_inset

, where 
\begin_inset Formula $B,B_{\mathrm{flat}}$
\end_inset

 are the energy barriers for the original and the 
\begin_inset Quotes eld
\end_inset

flat
\begin_inset Quotes erd
\end_inset

 system from either one of the two minima, and 
\begin_inset Formula $t,t_{\mathrm{flat}}$
\end_inset

 are the times taken for a round-trip between the states.
 This results in an estimate of 
\begin_inset Formula $t=4\cdot10^{6}$
\end_inset

 simulation steps for a return trip in the system shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Standard
In Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

 and Suppl.
 Figs.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_training_methods_NICER"
plural "false"
caps "false"
noprefix "false"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_training_methods_RealNVP"
plural "false"
caps "false"
noprefix "false"

\end_inset

 we use NICE and RealNVP networks defined as below.
 Networks are trained in two steps: in a first ML phase we only minimize
 
\begin_inset Formula $J_{\mathrm{KL}}$
\end_inset

.
 Subsequently we minimize 
\begin_inset Formula $J_{\mathrm{KL}}+J_{\mathrm{ML}}$
\end_inset

 with equal weights 
\begin_inset Formula $w_{\mathrm{ML}}=w_{\mathrm{KL}}=1$
\end_inset

, unless otherwise noted.
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="3" columns="3">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Network
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Epochs ML
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Epochs KL
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $N_{10}S$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
200
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1000
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $R_{10}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
200
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1000
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Paragraph
Bistable particle dimer in a Lennard-Jones fluid
\end_layout

\begin_layout Standard
Here we simulate two-dimensional system of a bistable particle dimer in
 a dense bath of 
\begin_inset Formula $n_{s}=36$
\end_inset

 solvent particles with Lennard-Jones repulsion.
 A similar system has been proposed in 
\begin_inset CommandInset citation
LatexCommand cite
key "NilmeyerEtAl_PNA11_NCMC"
literal "false"

\end_inset

.
 The configuration vector is defined by alternating 
\begin_inset Formula $x-$
\end_inset

 and 
\begin_inset Formula $y-$
\end_inset

 positions and starting with the two dimer particles:
\begin_inset Formula 
\[
\mathbf{x}=\left[\mathbf{x}_{1x},\mathbf{x}_{1y},\mathbf{x}_{2x},\mathbf{x}_{2y},...,\mathbf{x}_{(n_{s}+2)x},\mathbf{x}_{(n_{s}+2)y}\right].
\]

\end_inset

Defining the dimer distance 
\begin_inset Formula $d=\left\Vert \mathbf{x}_{1}-\mathbf{x}_{2}\right\Vert $
\end_inset

, and the Heavyside step function 
\begin_inset Formula $h$
\end_inset

, we use the potential energy:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
U(\mathbf{x}) & =k_{d}(\mathbf{x}_{1x}+\mathbf{x}_{2x})^{2}+k_{d}\mathbf{x}_{1y}^{2}+k_{d}\mathbf{x}_{2y}^{2}\\
 & +\frac{1}{4}a(d-d_{0})^{4}-\frac{1}{2}b(d-d_{0})^{2}+c(d-d_{0})^{4}\\
 & +\sum_{i=1}^{n+2}h(-\mathbf{x}_{ix}-l_{\mathrm{box}})k_{\mathrm{box}}(-\mathbf{x}_{ix}-l_{\mathrm{box}})^{2}+\sum_{i=1}^{n+2}h(\mathbf{x}_{ix}-l_{\mathrm{box}})k_{\mathrm{box}}(\mathbf{x}_{ix}-l_{\mathrm{box}})^{2}\\
 & +\sum_{i=1}^{n+2}h(-\mathbf{x}_{iy}-l_{\mathrm{box}})k_{\mathrm{box}}(-\mathbf{x}_{iy}-l_{\mathrm{box}})^{2}+\sum_{i=1}^{n+2}h(\mathbf{x}_{iy}-l_{\mathrm{box}})k_{\mathrm{box}}(\mathbf{x}_{iy}-l_{\mathrm{box}})^{2}\\
 & +\epsilon\sum_{i=1}^{n+1}\sum_{j=i+1,j\neq2}^{n+2}\left(\frac{\sigma}{\left\Vert \mathbf{x}_{i}-\mathbf{x}_{j}\right\Vert }\right)^{12}
\end{align*}

\end_inset

where the five rows correspond to: (1) Constraints for the center and the
 
\begin_inset Formula $y$
\end_inset

-position of the particle dimer, (2) particle dimer interaction, (3,4) box
 constraints in 
\begin_inset Formula $x-$
\end_inset

 and 
\begin_inset Formula $y-$
\end_inset

direction, (5) particle repulsion.
 The following parameter values were used (all in reduced units):
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="10">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Parameter
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\epsilon$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\sigma$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $k_{d}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $d_{0}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $a$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $b$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $l_{\mathrm{box}}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $k_{\mathrm{box}}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Value
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
20.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
25.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-0.5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
100.0
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
To initialize training, we run Metropolis Monte Carlo simulations with a
 Metropolis step length of 
\begin_inset Formula $\sigma_{\mathrm{Metro}}=0.02\sqrt{\tau}$
\end_inset

, where 
\begin_inset Formula $\tau$
\end_inset

 is the relative temperature.
 To estimate the time taken for a return-trip between open and closed dimer
 states, we take the same approach as for the double-well system above:
 We conduct a simulation with 
\begin_inset Formula $10^{6}$
\end_inset

 simulation steps for a system with maximally flattened energy (
\begin_inset Formula $a=2.5$
\end_inset

 and 
\begin_inset Formula $b=1.0$
\end_inset

).
 Still no transition from closed to open states occur, we thus estimate
 the 
\emph on
lower bound
\emph default
 for the return trip to be 
\begin_inset Formula $t=10^{6}\exp(B-B_{\mathrm{flat}})\approx1.2\cdot10^{12}$
\end_inset

 where 
\begin_inset Formula $B,B_{\mathrm{flat}}$
\end_inset

 are the intrinsic barrier heights for the unchanged and flattened system.
\end_layout

\begin_layout Standard
For validation of the free energy profiles predicted in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:particle_dimer"
plural "false"
caps "false"
noprefix "false"

\end_inset

i, we perform Umbrella Sampling simulations 
\begin_inset CommandInset citation
LatexCommand citep
key "Torrie_JCompPhys23_187"
literal "false"

\end_inset

 for each relative temperature 
\begin_inset Formula $(0.5,1.0,2.0)$
\end_inset

 using 35 Umbrella potentials on the dimer distance between values of 
\begin_inset Formula $0.5$
\end_inset

 and 
\begin_inset Formula $2.5$
\end_inset

 and with a force constant of 
\begin_inset Formula $500$
\end_inset

 (reduced units).

\change_inserted 880794617 1542208985
 Each umbrella simulation was 
\begin_inset Formula $50,000$
\end_inset

 steps, and to avoid hysteresis effects, we ran the umbrella sequence forward
 and backward, resulting in a total of 
\begin_inset Formula $3\cdot70\cdot50,000=10.5$
\end_inset

 million simulation steps.
\change_unchanged

\end_layout

\begin_layout Standard
For initializing the training by example (ML), 
\begin_inset Formula $10^{5}$
\end_inset

 simulation steps are stored for the 
\begin_inset Quotes eld
\end_inset

open
\begin_inset Quotes erd
\end_inset

 and 
\begin_inset Quotes eld
\end_inset

closed
\begin_inset Quotes erd
\end_inset

 dimer states.
 No transitions between these states occur in the simulations.
 In order to not have to learn the permutational invariance of the diffusing
 solvent particles from the data, we remove this invariance by relabeling
 solvent particles using the Hungarian algorithm 
\begin_inset CommandInset citation
LatexCommand citep
key "Kuhn_Naval55_HungarianMethod"
literal "false"

\end_inset

.
\end_layout

\begin_layout Standard
Boltzmann Generator training was done with 
\begin_inset Formula $w_{KL}=1$
\end_inset

 and decreasing 
\begin_inset Formula $w_{ML}$
\end_inset

 according to the following schedule:
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="7">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Epochs
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
20
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
200
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
300
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
300
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2000
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{ML}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
100
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
100
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
100
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
20
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\emph on
0.01
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{KL}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{RC}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\emph on
10
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
The italic values in the last row were treated as variable hyperparameters.
 We then did a hyperparameter search as indicated in the table below.
 The hyperparameters were chosen by minimizing the estimator variance for
 the free energy profile along dimer distance 
\begin_inset Formula $d$
\end_inset

.
 Each trained network makes predictions for the free energy profile shown
 in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:particle_dimer"
plural "false"
caps "false"
noprefix "false"

\end_inset

i.
 Using bootstrapping the standard error over all free energies along the
 profile between 
\begin_inset Formula $d=[0.5,2.5]$
\end_inset

 are computed, resulting in 
\begin_inset Formula $(\epsilon_{0.5},\epsilon_{1.0},\epsilon_{2.0})$
\end_inset

 for the three temperatures and 
\begin_inset Formula $\bar{\epsilon}=\sqrt{\epsilon_{0.5}^{2}+\epsilon_{1.0}^{2}+\epsilon_{2.0}^{2}}$
\end_inset

 as a total estimator error.
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Float table
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="24" columns="9">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Architecture
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $nl_{\mathrm{layers}}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $nl_{hidden}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{ML}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{RC}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\epsilon_{0.5}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\epsilon_{1}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\epsilon_{2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\sqrt{\sum\epsilon^{2}}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{R}_{8}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
200
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.62
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.07
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.04
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.33
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{R}_{4}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.23
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.83
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.53
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.27
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{R}_{6}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.69
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.64
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.29
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.28
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{R}_{12}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.49
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.85
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.10
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $(\mathrm{RN})_{2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.01
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.59
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.56
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.62
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $(\mathrm{RN})_{7}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.76
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.29
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.39
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.20
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $(\mathrm{RN})_{12}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.44
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.66
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.99
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.96
\end_layout

\end_inset
</cell>
</row>
<row>
<cell multirow="3" alignment="center" valignment="middle" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{R}_{8}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
200
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.51
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.97
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.64
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.97
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{R}_{4}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.41
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.59
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.78
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.77
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{R}_{6}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.49
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.73
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.76
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.88
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{R}_{12}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.84 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.28 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.24
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.17
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $(\mathrm{RN})_{2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.84
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.29
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.25
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.18
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $(\mathrm{RN})_{7}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.65
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.72
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.07
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.16
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $(\mathrm{RN})_{12}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.87
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.80
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.58
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.74
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mathrm{R}_{8}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.85
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.58
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.50
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.48
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.69
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.51
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.52
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.73
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
50
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.32
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.71
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.11
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.02
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
100
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.85
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.05
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.16
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4.12
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
200
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
0.01
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
1.58
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
1.33
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
1.33
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
2.45
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.87
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.93
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.63
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.15
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.66
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.83
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.75
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.02
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.73
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.72
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.81
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.03
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdot$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
20.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.88
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.06
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.84
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.34
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:hyperparameters_particle_dimer"

\end_inset

Hyperparameter selection for the particle dimer.
 In the architecture, 
\begin_inset Formula $R$
\end_inset

 corresponds to a RealNVP and 
\begin_inset Formula $N$
\end_inset

 to a NICE double layer with channel swaps (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:illustration"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
 The subscript indicates the number of repetitions, e.g.
 
\begin_inset Formula $\mathrm{R}_{4}=\mathrm{RRRR}$
\end_inset

, corresponding to eight single layers.
 All nonlinear transformations (
\begin_inset Formula $T$
\end_inset

, 
\begin_inset Formula $S$
\end_inset

) used dense networks with 
\begin_inset Formula $\mathrm{tanh}$
\end_inset

 activation using the given number of layers (
\begin_inset Formula $nl_{layers}$
\end_inset

) and hidden nodes (
\begin_inset Formula $nl_{hidden}$
\end_inset

).
 All networks were trained on the following range of relative temperatures:
 
\begin_inset Formula $\tau\in[0.1,0.25,0.5,0.75,1,1.5,2,3,4]$
\end_inset

 and used 
\begin_inset Formula $w_{KL}=1.0$
\end_inset

.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Free energy (umbrella sampling) vs dimer potential :
\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/particle_dimer_energies.pdf
	lyxscale 50
	width 50text%

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Paragraph
Hydrocarbons
\end_layout

\begin_layout Standard
A simple molecular mechanics model including bond, angle, torsion and Lennard-Jo
nes interactions (between all pairs) was implemented in TensorFlow.
 We use the parameters in 
\begin_inset CommandInset citation
LatexCommand cite
key "NikitinEtAl_JMolModel14_AMBERAlkanes"
literal "false"

\end_inset

 to modeling the alkanes shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:hydrocarbon"
plural "false"
caps "false"
noprefix "false"

\end_inset

: (1) cyclononane 
\begin_inset Formula $C_{9}H_{18}$
\end_inset

, i.e.
 a ring of nine 
\begin_inset Formula $CH_{2}$
\end_inset

 groups, and (2) bicyclo[4.4.4]tetradecane 
\begin_inset Formula $C_{14}H_{26}$
\end_inset

, connected as follows:
\begin_inset Formula 
\[
\begin{array}{c}
-CH_{2}-CH_{2}-CH_{2}-CH_{2}-\\
/\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\backslash\\
CH-CH_{2}-CH_{2}-CH_{2}-CH_{2}-CH\\
\backslash\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:\:/\\
-CH_{2}-CH_{2}-CH_{2}-CH_{2}-
\end{array}
\]

\end_inset


\end_layout

\begin_layout Standard
To generate some initial structures for training by example, we conducted
 a short (
\begin_inset Formula $14,000$
\end_inset

 steps) replica-exchange simulation with relative temperatures 
\begin_inset Formula $\tau=(1,1.5,2,2.5,3,3.5,4)$
\end_inset

 where 
\begin_inset Formula $300$
\end_inset

 Kelvin is the standard temperature.
 We used Metropolis-Monte Carlo step length 
\begin_inset Formula $\sigma_{\mathrm{Metro}}=0.01\,\text{Å}$
\end_inset

.
 The main aim of this simulation is to equilibrate the structure which is
 started from a random placement of atoms in space.
 The first 
\begin_inset Formula $10,000$
\end_inset

 steps were discarded and the last 
\begin_inset Formula $4,000$
\end_inset

 steps were retained for training.
 
\end_layout

\begin_layout Standard
The Boltzmann Generator is trained using iterative discovery.
 In each of 50 iterations, we use 
\begin_inset Formula $4,000$
\end_inset

 configurations for training by example, and we train using the following
 schedule:
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
First Iteration
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Next Iterations
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Epochs
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
300
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
300
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
300
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
300
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{ML}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{KL}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.01
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
At the end of each iteration, we use the Boltzmann Generator to sample 
\begin_inset Formula $10^{6}$
\end_inset

 structures and make a list of all rotamer conformations that have been
 generated.
 A rotamer is defined by discretizing each torsion as follows:
\end_layout

\begin_layout Standard
\noindent
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Rotamer
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Angle
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-120°...0°
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0°...120°
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
120°...-120°
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
And the rotamer conformation is the combination of all rotamers, e.g.
 
\begin_inset Quotes eld
\end_inset

123211211
\begin_inset Quotes erd
\end_inset

.
 We remove permutational symmetries, in cycloalkanes this is achieved by
 setting all rotamer conformations equal that can be transformed by mirroring
 or cyclical permutation.
 After listing all conformations, we resample a list of 
\begin_inset Formula $4,000$
\end_inset

 configurations, but now each rotamer conformation found has an equal probabilit
y of being sampled.
 This list is inserted into the next iteration for training by example.
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
clearpage
\end_layout

\end_inset


\end_layout

\begin_layout Subsection*
D.
 Additional Figures
\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/SFig_Training_NICER.pdf
	width 80text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig_training_methods_NICER"

\end_inset

Different methods for training Boltzmann Generators with NICE layers using
 the double well example shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:double_well"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 Columns show: (1) distribution in configuration space 
\begin_inset Formula $\mathbf{x}$
\end_inset

, (2) distribution in latent space 
\begin_inset Formula $\mathbf{z}$
\end_inset

, (3) free energy of Boltzmann Generator output 
\begin_inset Formula $p_{X}(\mathbf{x})$
\end_inset

 along 
\begin_inset Formula $x_{1}$
\end_inset

, (4) free energy after reweighting.
 Training uses 200 epochs of ML and then 500 epochs of the method given
 in the rows, using equal weights for these modes.
 Training by example (ML) only reproduces the distribution of the training
 data, which can be reweighted to the Boltzmann distribution in this low-dimensi
onal example but reweighting fails for high-dimensional examples.
 Training by energy (KL) only tends to collapse to one metastable state.
 ML+KL combined samples closer to the Boltzmann distribution than ML and
 avoids metastable state collapse, but samples high-energy transition states
 with low probability.
 KL+RC performs best in this example.
 
\end_layout

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/SFig_Training_RealNVP.pdf
	width 80text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig_training_methods_RealNVP"

\end_inset

Same as Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig_training_methods_NICER"
plural "false"
caps "false"
noprefix "false"

\end_inset

 but for Boltzmann Generators using RealNVP layers.
\end_layout

\end_inset

 
\end_layout

\end_inset


\end_layout

\end_body
\end_document
